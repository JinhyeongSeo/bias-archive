---
phase: 04-search-filter
plan: 02
type: execute
depends_on: ["04-01"]
files_modified: [src/lib/youtube.ts, src/app/api/youtube/search/route.ts, src/components/YouTubeSearch.tsx, src/components/Sidebar.tsx]
---

<objective>
YouTube 통합 검색 기능 구현

Purpose: 앱 내에서 YouTube 직캠을 검색하고 바로 저장할 수 있게 함 (URL 복사 불필요)
Output: YouTube 검색 UI, 검색 결과 미리보기, 선택 저장 기능
</objective>

<execution_context>
./.claude/get-shit-done/workflows/execute-plan.md
./.claude/get-shit-done/templates/summary.md
./.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-search-filter/DISCOVERY.md

# Discovery 핵심 정보
- YouTube Data API v3: 무료 10,000 units/day
- search.list: 100 units/request (하루 ~100회 검색)
- API 키: YOUTUBE_API_KEY 환경변수

# 기존 코드 참조
@src/lib/metadata.ts - 기존 메타데이터 추출 패턴
@src/app/api/links/route.ts - POST 저장 패턴
@src/components/AddLinkModal.tsx - 링크 추가 UI 패턴
</context>

<tasks>

<task type="auto">
  <name>Task 1: YouTube 검색 API 라우트 생성</name>
  <files>src/lib/youtube.ts, src/app/api/youtube/search/route.ts</files>
  <action>
  1. src/lib/youtube.ts 생성:
     - searchYouTube(query: string, maxResults?: number) 함수
     - YouTube Data API v3 search.list 호출
     - 반환 타입: { videoId, title, description, thumbnailUrl, channelTitle, publishedAt }[]
     - 에러 처리: quota 초과 시 명확한 에러 메시지

  2. src/app/api/youtube/search/route.ts 생성:
     - GET /api/youtube/search?q={query}&max={number}
     - YOUTUBE_API_KEY 환경변수 확인
     - 없으면 501 Not Implemented 반환 (설정 안내)
     - searchYouTube() 호출 후 결과 반환

  API 엔드포인트:
  GET https://www.googleapis.com/youtube/v3/search
    ?part=snippet
    &q={query}
    &type=video
    &maxResults={max}
    &key={YOUTUBE_API_KEY}

  주의: 클라이언트에 API 키 노출 금지 - 서버 사이드에서만 처리
  </action>
  <verify>
  1. .env.local에 YOUTUBE_API_KEY 없이 테스트:
     curl 'http://localhost:3000/api/youtube/search?q=test' → 501 응답
  2. YOUTUBE_API_KEY 추가 후:
     curl 'http://localhost:3000/api/youtube/search?q=fancam' → 검색 결과 반환
  </verify>
  <done>
  - /api/youtube/search API 작동
  - API 키 없을 때 적절한 에러 메시지
  - 검색 결과에 videoId, title, thumbnailUrl 포함
  </done>
</task>

<task type="checkpoint:human-action" gate="blocking">
  <action>YouTube API 키 설정</action>
  <instructions>
  YouTube 검색 기능을 사용하려면 API 키가 필요합니다.

  1. Google Cloud Console 접속: https://console.cloud.google.com/
  2. 프로젝트 생성 또는 선택
  3. APIs & Services > Library에서 "YouTube Data API v3" 활성화
  4. APIs & Services > Credentials에서 API 키 생성
  5. .env.local에 추가:
     ```
     YOUTUBE_API_KEY=your_api_key_here
     ```

  (이미 설정되어 있다면 "skip" 입력)
  </instructions>
  <verification>curl 테스트로 API 작동 확인</verification>
  <resume-signal>API 키 설정 완료 후 "done" 또는 이미 있으면 "skip" 입력</resume-signal>
</task>

<task type="auto">
  <name>Task 2: YouTube 검색 UI 컴포넌트 및 통합</name>
  <files>src/components/YouTubeSearch.tsx, src/components/Sidebar.tsx</files>
  <action>
  1. src/components/YouTubeSearch.tsx 생성:
     - 검색 입력 필드 + 검색 버튼
     - 검색 결과 목록 (썸네일, 제목, 채널, 날짜)
     - 각 결과에 "저장" 버튼
     - 저장 시 /api/links POST 호출 (URL: https://youtube.com/watch?v={videoId})
     - 저장 성공 시 토스트 또는 체크 표시
     - 검색 중 로딩 상태

  2. src/components/Sidebar.tsx 수정:
     - "YouTube 검색" 섹션 추가 (태그 섹션 아래)
     - 토글 버튼으로 YouTubeSearch 컴포넌트 표시/숨김
     - 또는 별도 모달로 구현

  UI 요구사항:
  - 결과당 썸네일 (120x90 기본)
  - 제목 (1-2줄 말줄임)
  - 채널명
  - 저장 버튼 (이미 저장된 URL이면 비활성화)

  저장 연동:
  - 기존 /api/links POST 재사용
  - 저장 후 refreshTrigger 증가하여 목록 갱신
  </action>
  <verify>
  npm run dev 후:
  1. 사이드바에서 YouTube 검색 UI 확인
  2. 검색어 입력 → 결과 표시 확인
  3. "저장" 클릭 → 링크 목록에 추가 확인
  4. 중복 저장 시 에러 처리 확인
  </verify>
  <done>
  - YouTube 검색 UI 작동
  - 검색 결과 썸네일/제목/채널 표시
  - 저장 버튼 클릭 시 링크 추가
  - 저장 후 목록 자동 갱신
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] npm run build 성공
- [ ] npm run lint 통과
- [ ] YouTube 검색 API 작동 (API 키 설정 시)
- [ ] 검색 결과 UI 표시
- [ ] 결과에서 저장 클릭 시 링크 추가
- [ ] 저장 후 메인 목록 갱신
- [ ] API 키 미설정 시 적절한 안내
</verification>

<success_criteria>

- 모든 tasks 완료
- 검증 항목 모두 통과
- YouTube 통합 검색으로 URL 복사 없이 직캠 저장 가능
- Phase 4 complete
</success_criteria>

<output>
After completion, create `.planning/phases/04-search-filter/04-02-SUMMARY.md`
</output>
