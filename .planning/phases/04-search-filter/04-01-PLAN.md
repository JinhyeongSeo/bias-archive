---
phase: 04-search-filter
plan: 01
type: execute
depends_on: []
files_modified: [src/lib/links.ts, src/app/api/links/route.ts, src/components/Sidebar.tsx, src/components/LinkList.tsx, src/app/page.tsx]
---

<objective>
아카이브 검색 및 태그 필터링 기능 구현

Purpose: 저장된 링크를 텍스트 검색과 태그/플랫폼 필터로 빠르게 찾을 수 있게 함
Output: 검색 바, 태그 필터, 플랫폼 필터가 작동하는 아카이브 페이지
</objective>

<execution_context>
./.claude/get-shit-done/workflows/execute-plan.md
./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-search-filter/DISCOVERY.md

# 기존 코드 참조
@src/lib/links.ts - getLinksWithTags() 함수 패턴
@src/app/api/links/route.ts - 현재 bias_id만 지원
@src/components/Sidebar.tsx - selectedTagId 클릭 핸들러 있음
@src/components/LinkList.tsx - fetchLinks() 함수

# Phase 3 결정사항
- refreshTrigger 패턴으로 목록 새로고침
- RefreshContext로 전역 상태 관리
</context>

<tasks>

<task type="auto">
  <name>Task 1: 검색/필터 지원하는 링크 조회 함수 및 API 확장</name>
  <files>src/lib/links.ts, src/app/api/links/route.ts</files>
  <action>
  1. src/lib/links.ts에 searchLinksWithTags() 함수 추가:
     - 파라미터: { biasId?, search?, tagIds?, platform? }
     - search: title, description, author_name에 대해 .ilike() 검색 (OR 조건)
     - tagIds: 배열로 받아서 link_tags 테이블 JOIN 필터링
     - platform: 정확히 일치
     - 기존 getLinksWithTags() 패턴 유지 (태그 변환 로직)

  2. src/app/api/links/route.ts GET 핸들러 수정:
     - 쿼리 파라미터 추가: search, tags (쉼표 구분), platform
     - searchLinksWithTags() 호출
     - 기존 bias_id 호환성 유지

  주의: Supabase에서 다중 OR 조건은 .or() 메서드 사용
  예: .or(`title.ilike.%${search}%,description.ilike.%${search}%,author_name.ilike.%${search}%`)
  </action>
  <verify>
  curl 'http://localhost:3000/api/links?search=test' 로 검색 결과 확인
  curl 'http://localhost:3000/api/links?platform=youtube' 로 필터링 확인
  </verify>
  <done>
  - search 파라미터로 제목/설명/작성자명 검색 가능
  - platform 파라미터로 플랫폼 필터링 가능
  - tags 파라미터로 태그 필터링 가능 (쉼표 구분 ID)
  </done>
</task>

<task type="auto">
  <name>Task 2: 메인 페이지에 검색/필터 상태 관리 및 Sidebar 연동</name>
  <files>src/app/page.tsx, src/components/Sidebar.tsx, src/components/LinkList.tsx</files>
  <action>
  1. src/app/page.tsx 수정:
     - 상태 추가: searchQuery, selectedTagId, selectedPlatform
     - Sidebar에 onSelectTag 전달 (이미 props 있음)
     - LinkList에 필터 상태 전달

  2. src/components/Sidebar.tsx 수정:
     - 검색 입력 필드 추가 (섹션 최상단)
     - 플랫폼 필터 버튼 추가 (YouTube, Twitter, Weverse, 전체)
     - 검색/플랫폼 변경 시 콜백 호출
     - Props 추가: searchQuery, onSearchChange, selectedPlatform, onSelectPlatform

  3. src/components/LinkList.tsx 수정:
     - Props 추가: searchQuery?, tagId?, platform?
     - fetchLinks()에서 쿼리 파라미터 추가
     - 필터 변경 시 리페치 (useEffect 의존성)

  UI 스타일: 기존 Sidebar 스타일 유지 (zinc 색상, rounded 버튼)
  </action>
  <verify>
  npm run dev 후:
  1. 사이드바 검색창에 입력 → 링크 목록 필터링 확인
  2. 태그 클릭 → 해당 태그 링크만 표시 확인
  3. 플랫폼 버튼 클릭 → 해당 플랫폼 링크만 표시 확인
  4. 여러 필터 조합 테스트
  </verify>
  <done>
  - 검색창 입력으로 실시간 검색 작동
  - 태그 클릭으로 필터링 작동 (재클릭 시 해제)
  - 플랫폼 버튼으로 필터링 작동
  - 필터 조합 시 AND 조건으로 작동
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] npm run build 성공
- [ ] npm run lint 통과
- [ ] 검색어 입력 시 제목/설명/작성자명 검색 작동
- [ ] 태그 필터 클릭 시 해당 태그 링크만 표시
- [ ] 플랫폼 필터 클릭 시 해당 플랫폼 링크만 표시
- [ ] 필터 조합 (검색 + 태그 + 플랫폼) 작동
- [ ] 필터 해제 시 전체 목록 복원
</verification>

<success_criteria>

- 모든 tasks 완료
- 검증 항목 모두 통과
- 아카이브 검색 및 필터링이 사용자 친화적으로 작동
</success_criteria>

<output>
After completion, create `.planning/phases/04-search-filter/04-01-SUMMARY.md`
</output>
