---
phase: 02-link-management
plan: 02
type: execute
depends_on: ["02-01"]
files_modified: [src/app/api/links/route.ts, src/lib/links.ts, src/components/LinkForm.tsx, src/components/LinkCard.tsx, src/components/LinkList.tsx, src/app/page.tsx]
---

<objective>
링크 저장 및 CRUD 기능 구현

Purpose: 추출된 메타데이터와 함께 링크를 Supabase에 저장하고, 저장된 링크 목록을 표시
Output: 링크 생성/조회/삭제 기능 + 링크 카드 목록 UI
</objective>

<execution_context>
./.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-link-management/02-01-SUMMARY.md

@src/lib/supabase.ts
@src/lib/metadata.ts
@src/types/database.ts
@src/components/LinkForm.tsx

**Tech stack available:** Next.js 16, React 19, Tailwind, Supabase, open-graph-scraper
**Established patterns:** App Router API routes, typed Supabase client

**DB 스키마 (links 테이블):**
- id, url, title, description, thumbnail_url, platform, original_date, bias_id
- created_at, updated_at
</context>

<tasks>

<task type="auto">
  <name>Task 1: 링크 CRUD API 엔드포인트 생성</name>
  <files>src/app/api/links/route.ts, src/lib/links.ts</files>
  <action>
1. `src/lib/links.ts` 생성 - Supabase 링크 CRUD 함수:
   - createLink(data: LinkInsert): Promise<Link>
   - getLinks(biasId?: string): Promise<Link[]> - 최신순 정렬
   - deleteLink(id: string): Promise<void>
   - getLinkById(id: string): Promise<Link | null>

2. `src/app/api/links/route.ts` 생성:
   - GET: 모든 링크 조회 (bias_id 쿼리 파라미터 지원)
   - POST: 새 링크 저장 (url, title, description, thumbnailUrl, platform, originalDate, biasId)
   - 중복 URL 체크 (같은 URL 이미 존재 시 에러)

3. `src/app/api/links/[id]/route.ts` 생성:
   - GET: 단일 링크 조회
   - DELETE: 링크 삭제

**주의사항:**
- Supabase 에러 핸들링 (적절한 HTTP 상태 코드)
- TypeScript 타입 안전성 유지 (database.ts 타입 사용)
- 빈 bias_id 허용 (나중에 bias 선택 기능 추가)
  </action>
  <verify>curl -X POST http://localhost:3000/api/links -H "Content-Type: application/json" -d '{"url":"https://example.com","title":"Test","platform":"other"}' 로 링크 생성 후, curl http://localhost:3000/api/links 로 조회 확인</verify>
  <done>링크 CRUD API 동작, Supabase에 데이터 저장/조회/삭제 가능</done>
</task>

<task type="auto">
  <name>Task 2: LinkForm에 저장 기능 연결 및 LinkList 컴포넌트 생성</name>
  <files>src/components/LinkForm.tsx, src/components/LinkCard.tsx, src/components/LinkList.tsx, src/app/page.tsx</files>
  <action>
1. `src/components/LinkForm.tsx` 수정:
   - 미리보기 확인 후 "저장" 버튼 추가
   - POST /api/links 호출하여 저장
   - 저장 성공 시 폼 초기화 + onSave 콜백 호출

2. `src/components/LinkCard.tsx` 생성:
   - 링크 카드 UI (썸네일, 제목, 플랫폼 뱃지, 날짜)
   - 썸네일: 16:9 비율, object-cover
   - 플랫폼별 색상 뱃지 (YouTube: 빨강, Twitter: 파랑, 기타: 회색)
   - 삭제 버튼 (휴지통 아이콘)
   - 원본 링크로 이동 (외부 링크 아이콘)

3. `src/components/LinkList.tsx` 생성:
   - 링크 목록 fetch 및 표시
   - 그리드 레이아웃 (반응형: 1열/2열/3열)
   - 빈 상태 메시지 ("저장된 링크가 없습니다")
   - 삭제 시 목록 새로고침

4. `src/app/page.tsx` 수정:
   - LinkForm + LinkList 배치
   - 저장 성공 시 LinkList 새로고침

**주의사항:**
- next/image 사용 시 remotePatterns 설정 필요 (next.config.js)
- 삭제 확인 dialog 추가
- 다크모드 스타일 지원
  </action>
  <verify>브라우저에서 URL 입력 → 미리보기 → 저장 → 목록에 표시 → 삭제 동작 확인</verify>
  <done>전체 링크 저장 플로우 동작, 목록 표시 및 삭제 기능 완료</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` 에러 없음
- [ ] 링크 저장 후 Supabase 테이블에 데이터 확인
- [ ] 저장된 링크가 목록에 표시됨
- [ ] 삭제 기능 동작
- [ ] 중복 URL 저장 시 에러 메시지 표시
- [ ] 다크모드에서 UI 정상 표시
</verification>

<success_criteria>

- 링크 CRUD API 동작 (생성, 조회, 삭제)
- LinkForm → 저장 → LinkList 표시 플로우 완료
- 링크 카드에 썸네일, 제목, 플랫폼 표시
- 빌드 성공, TypeScript 에러 없음
</success_criteria>

<output>
After completion, create `.planning/phases/02-link-management/02-02-SUMMARY.md`
</output>
