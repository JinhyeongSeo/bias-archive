---
phase: 02-link-management
plan: 01
type: execute
depends_on: []
files_modified: [src/lib/metadata.ts, src/app/api/metadata/route.ts, src/components/LinkForm.tsx, src/app/page.tsx]
---

<objective>
URL 입력 폼과 메타데이터 추출 API 구축

Purpose: URL 입력 시 자동으로 메타데이터(제목, 썸네일, 플랫폼)를 추출하여 사용자에게 미리보기 제공
Output: 동작하는 URL 입력 폼 + 메타데이터 추출 API 엔드포인트
</objective>

<execution_context>
./.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-03-SUMMARY.md

@src/lib/supabase.ts
@src/types/database.ts
@src/components/Header.tsx
@src/app/page.tsx

**Tech stack available:** Next.js 16, React 19, Tailwind, Supabase, next-themes
**Established patterns:** App Router, src/ directory, components/ 폴더

**Discovery 결과:**
- YouTube oEmbed: `youtube.com/oembed?url=...&format=json` (API 키 불필요)
- Twitter oEmbed: `publish.twitter.com/oembed?url=...` (API 키 불필요)
- 일반 URL: `open-graph-scraper` 패키지 (OG/Twitter Card 추출)
- 플랫폼 감지: URL 패턴으로 youtube/twitter/weverse 구분
</context>

<tasks>

<task type="auto">
  <name>Task 1: 메타데이터 추출 서비스 및 API 엔드포인트 생성</name>
  <files>src/lib/metadata.ts, src/app/api/metadata/route.ts, package.json</files>
  <action>
1. `open-graph-scraper` 설치 (npm install open-graph-scraper)

2. `src/lib/metadata.ts` 생성:
   - URL에서 플랫폼 감지 함수: detectPlatform(url) → 'youtube' | 'twitter' | 'weverse' | 'other'
   - YouTube 패턴: youtube.com, youtu.be
   - Twitter 패턴: twitter.com, x.com
   - Weverse 패턴: weverse.io

3. `src/lib/metadata.ts`에 메타데이터 추출 함수:
   - extractMetadata(url) → { title, description, thumbnailUrl, platform, originalDate?, authorName? }
   - YouTube: oEmbed API 호출 (https://www.youtube.com/oembed?url=${url}&format=json)
   - Twitter: oEmbed API 호출 (https://publish.twitter.com/oembed?url=${url})
   - 기타: open-graph-scraper 사용

4. `src/app/api/metadata/route.ts` 생성:
   - POST 핸들러: { url } → 메타데이터 반환
   - URL 유효성 검증 (try new URL())
   - 에러 시 적절한 HTTP 상태 코드 반환

**주의사항:**
- oEmbed API는 서버 사이드에서만 호출 (CORS 문제 방지)
- 타임아웃 설정 (5초)
- 빈 URL이나 잘못된 URL 처리
  </action>
  <verify>curl -X POST http://localhost:3000/api/metadata -H "Content-Type: application/json" -d '{"url":"https://www.youtube.com/watch?v=dQw4w9WgXcQ"}' 실행하여 title, thumbnailUrl 반환 확인</verify>
  <done>API가 YouTube/Twitter/일반 URL에서 메타데이터를 추출하여 JSON 반환</done>
</task>

<task type="auto">
  <name>Task 2: URL 입력 폼 컴포넌트 생성</name>
  <files>src/components/LinkForm.tsx, src/app/page.tsx</files>
  <action>
1. `src/components/LinkForm.tsx` 생성:
   - URL 입력 필드 (input type="url")
   - "추가" 버튼
   - 로딩 상태 표시
   - API 호출하여 메타데이터 미리보기 표시
   - 미리보기: 썸네일 이미지 + 제목 + 플랫폼 뱃지
   - 에러 메시지 표시 영역

2. 스타일링:
   - Tailwind 다크모드 지원 (dark: 클래스)
   - 입력 필드: 둥근 모서리, 포커스 링
   - 버튼: 기본 색상, 호버 효과
   - 미리보기 카드: 썸네일 + 텍스트 레이아웃

3. `src/app/page.tsx` 수정:
   - 기존 "시작하려면 링크를 추가하세요" 대신 LinkForm 렌더링
   - 메인 영역에 폼 배치

**주의사항:**
- 'use client' 지시어 필요 (상태 관리)
- 이미지 도메인 설정 필요할 수 있음 (next.config.js remotePatterns)
- 아직 DB 저장은 구현하지 않음 (02-02에서 구현)
  </action>
  <verify>브라우저에서 YouTube URL 입력 후 썸네일과 제목이 표시되는지 확인</verify>
  <done>URL 입력 → API 호출 → 메타데이터 미리보기 표시 동작</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` 에러 없음
- [ ] YouTube URL로 메타데이터 추출 동작
- [ ] Twitter URL로 메타데이터 추출 동작
- [ ] 일반 URL로 Open Graph 추출 동작
- [ ] 잘못된 URL 입력 시 에러 메시지 표시
- [ ] 다크모드에서 UI 정상 표시
</verification>

<success_criteria>

- URL 입력 폼이 메인 페이지에 표시됨
- 메타데이터 API가 3가지 플랫폼 지원 (YouTube, Twitter, 기타)
- 미리보기에 썸네일, 제목, 플랫폼 표시
- 빌드 성공, TypeScript 에러 없음
</success_criteria>

<output>
After completion, create `.planning/phases/02-link-management/02-01-SUMMARY.md`
</output>
