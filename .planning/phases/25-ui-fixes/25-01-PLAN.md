---
phase: 25-ui-fixes
plan: 01
type: execute
depends_on: []
files_modified: [src/components/Sidebar.tsx, src/app/api/export/route.ts]
---

<objective>
Sidebar 태그 섹션과 구분선 사이 여백 추가 + 내보내기 통계 0/0/0 버그 수정

Purpose: UI 마무리 및 데이터 내보내기 기능이 로그인된 사용자 데이터를 올바르게 반환하도록 수정
Output: 태그와 데이터 관리 섹션 사이 적절한 간격, 내보내기 통계에 실제 사용자 데이터 표시
</objective>

<execution_context>
./.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# 관련 소스 파일:
@src/components/Sidebar.tsx
@src/app/api/export/route.ts
@src/lib/export.ts
@src/lib/supabase-server.ts

# 참고: 다른 API 라우트 인증 패턴
@src/app/api/biases/route.ts

**문제 분석:**

1. **태그 구분선 간격**:
   - Sidebar.tsx:411 Tags 섹션 (`<section className="flex-1">`)
   - Sidebar.tsx:550 Data Management 섹션 (`<section className="pt-4 border-t border-border">`)
   - 두 섹션 사이에 여백이 없어 border-t가 Tags 섹션에 바로 맞닿음
   - 해결: Tags 섹션에 `mb-6` 추가

2. **내보내기 통계 0/0/0 버그**:
   - `/api/export`는 `src/lib/export.ts`의 `exportAllData()` 함수 호출
   - `exportAllData()`는 브라우저 클라이언트 `supabase`를 사용 (세션 없음)
   - RLS가 활성화되어 있어 인증되지 않은 요청은 빈 배열 반환
   - 해결: `/api/export`에서 직접 `createClient()`를 사용하여 서버 세션으로 데이터 조회
</context>

<tasks>

<task type="auto">
  <name>Task 1: Tags 섹션과 Data Management 사이 여백 추가</name>
  <files>src/components/Sidebar.tsx</files>
  <action>
Tags 섹션(line ~411)의 클래스에 `mb-6`을 추가하여 아래 구분선과의 간격 확보.

변경:
- `<section className="flex-1">` → `<section className="flex-1 mb-6">`

이렇게 하면 Tags 섹션과 Data Management 섹션의 border-t 사이에 1.5rem(24px) 여백이 생김.
  </action>
  <verify>npm run build 성공, UI에서 Tags와 "데이터 관리" 버튼 사이 적절한 간격 확인</verify>
  <done>Tags 섹션 하단에 mb-6 클래스 추가됨, border-t와 맞닿지 않음</done>
</task>

<task type="auto">
  <name>Task 2: Export API를 서버 세션 기반으로 수정</name>
  <files>src/app/api/export/route.ts</files>
  <action>
`/api/export` API 라우트를 수정하여 서버 측 Supabase 클라이언트를 사용하고 인증된 사용자의 데이터만 반환하도록 변경.

1. `createClient`를 `@/lib/supabase-server`에서 import
2. 인증 체크 추가 (user가 없으면 401 반환)
3. 기존 `exportAllData()` 호출 대신 직접 쿼리 실행:
   - biases: `select('*').order('sort_order')` (RLS가 user_id 필터링)
   - tags: `select('*').order('name')` (RLS가 user_id 필터링)
   - links: `select('*, link_tags(tags(*)), link_media(*)').order('created_at', desc)` (RLS가 user_id 필터링)
4. links 변환 로직은 기존 `exportAllData`와 동일하게 유지

참고: RLS 정책이 이미 user_id 기반 필터링을 하므로, 서버 클라이언트가 쿠키에서 세션을 읽으면 자동으로 현재 사용자 데이터만 반환됨.
  </action>
  <verify>
1. 로그인 상태에서 /api/export 호출 시 실제 데이터 반환 확인
2. npm run build 성공
  </verify>
  <done>
- `/api/export`가 서버 세션 기반으로 인증된 사용자 데이터 반환
- 비로그인 시 401 반환
- ExportModal에서 통계가 실제 링크/태그/최애 수로 표시됨
  </done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `npm run build` 성공
- [ ] Sidebar에서 Tags 섹션과 "데이터 관리" 버튼 사이 여백 확인
- [ ] 로그인 상태에서 "데이터 관리" 모달 열었을 때 실제 통계 표시 (0/0/0이 아님)
- [ ] 비로그인 상태에서 "데이터 관리" 접근 시 적절한 처리
</verification>

<success_criteria>

- 모든 태스크 완료
- 모든 검증 체크 통과
- TypeScript 에러 없음
- Tags 섹션과 구분선 사이 적절한 여백
- Export 통계가 실제 사용자 데이터 반영
</success_criteria>

<output>
After completion, create `.planning/phases/25-ui-fixes/25-01-SUMMARY.md`:

# Phase 25 Plan 01: UI Fixes Summary

**[한 줄 요약]**

## Accomplishments

- [Key outcome 1]
- [Key outcome 2]

## Files Created/Modified

- `path/to/file.ts` - Description

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Phase complete, ready for next phase
</output>
