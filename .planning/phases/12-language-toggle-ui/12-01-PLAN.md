---
phase: 12-language-toggle-ui
plan: 01
type: execute
depends_on: []
files_modified:
  - src/contexts/NameLanguageContext.tsx
  - src/components/Providers.tsx
  - src/components/NameLanguageToggle.tsx
  - src/components/Header.tsx
  - src/components/Sidebar.tsx
  - src/components/BiasManager.tsx
  - src/lib/biases.ts
  - messages/ko.json
  - messages/en.json
---

<objective>
앱 전역 "이름 표시 언어" 토글 구현, 최애/태그 이름을 현재 언어 모드에 따라 표시 전환

Purpose: 사용자가 영어/한글 모드를 선택하면 최애 목록, 태그 목록의 이름이 해당 언어로 표시됨
Output: NameLanguageContext, NameLanguageToggle 컴포넌트, Sidebar/BiasManager 언어별 표시 로직
</objective>

<execution_context>
./.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11-bias-schema-extension/11-01-SUMMARY.md

**Phase 11에서 제공:**
- biases 테이블에 name_en/name_ko nullable 컬럼 추가됨
- 기존 name 필드는 표시용으로 유지
- 그룹 일괄 추가 시 자동으로 영어/한글 이름 저장됨

**Tech stack available:**
- next-themes (다크모드 토글 패턴)
- next-intl (UI 언어, locale 기반)
- RefreshContext (상태 공유 패턴)

**Established patterns:**
- ThemeProvider + useTheme 패턴 (next-themes)
- Context + Provider 패턴 (RefreshContext)
- localStorage로 사용자 선호 저장

**Key files:**
- src/components/ThemeToggle.tsx - next-themes 토글 패턴
- src/components/Providers.tsx - Provider 조합
- src/contexts/RefreshContext.tsx - Context 패턴
- src/components/Sidebar.tsx - 최애/태그 목록 표시
- src/components/BiasManager.tsx - 최애 목록 관리
- src/types/database.ts - Bias 타입 (name_en, name_ko 필드)

**Constraining decisions:**
- [Phase 11]: name_en/name_ko는 nullable, 기존 name 필드 유지
- [Phase 6]: next-intl로 UI 언어 관리 (ko/en locale)

**참고:** 이 "이름 표시 언어"는 next-intl의 UI locale과 독립적임.
- UI locale (next-intl): 버튼, 레이블 등 인터페이스 번역
- 이름 표시 언어 (이 Phase): 최애/태그 이름을 영어/한글로 표시
- 둘은 별개 설정 (예: UI는 영어, 이름은 한글로 표시 가능)
</context>

<tasks>

<task type="auto">
  <name>Task 1: NameLanguageContext 및 NameLanguageToggle 생성</name>
  <files>src/contexts/NameLanguageContext.tsx, src/components/NameLanguageToggle.tsx, src/components/Providers.tsx</files>
  <action>
1. src/contexts/NameLanguageContext.tsx 생성:
   - NameLanguageProvider와 useNameLanguage hook
   - 상태: 'en' | 'ko' | 'auto' (auto = UI locale 따름)
   - localStorage 키: 'name-language'
   - getDisplayName(bias: Bias) 헬퍼 함수 제공
     - 'en': name_en || name
     - 'ko': name_ko || name
     - 'auto': UI locale에 따라 name_en/name_ko 선택, 없으면 name
   - hydration 안전 처리 (mounted 상태)

2. src/components/NameLanguageToggle.tsx 생성:
   - ThemeToggle.tsx 패턴 참고
   - 3가지 옵션: EN / KO / Auto
   - 현재 선택된 옵션 하이라이트
   - mounted 전까지 placeholder 렌더

3. src/components/Providers.tsx 수정:
   - NameLanguageProvider 추가 (ThemeProvider 안에)
  </action>
  <verify>npm run build 성공, TypeScript 에러 없음</verify>
  <done>NameLanguageContext 생성됨, Providers에 추가됨, 빌드 성공</done>
</task>

<task type="auto">
  <name>Task 2: Header에 NameLanguageToggle 추가 및 Sidebar/BiasManager 표시 적용</name>
  <files>src/components/Header.tsx, src/components/Sidebar.tsx, src/components/BiasManager.tsx, src/lib/biases.ts, messages/ko.json, messages/en.json</files>
  <action>
1. src/components/Header.tsx 수정:
   - NameLanguageToggle import 및 추가 (LanguageSwitcher 옆)
   - 레이아웃: NameLanguageToggle | LanguageSwitcher | ThemeToggle

2. src/lib/biases.ts 수정:
   - getBiasDisplayName(bias: Bias, language: 'en' | 'ko' | 'auto', locale?: string) 함수 추가
   - 이 함수는 Context 없이도 사용 가능 (API 호출 등)

3. src/components/BiasManager.tsx 수정:
   - useNameLanguage hook import
   - formatBiasName 함수에서 getDisplayName 사용
   - 목록 표시 시 언어 모드에 따른 이름 표시

4. src/components/Sidebar.tsx 수정:
   - useNameLanguage hook import
   - 최애 목록 표시 시 getDisplayName 사용 (BiasManager에서 처리됨)
   - 태그 목록은 현재 단순 name만 있음 (Phase 13에서 처리 예정)

5. messages/ko.json, messages/en.json 수정:
   - header.nameLanguage 키 추가: "이름 표시" / "Name Display"
   - header.nameLanguageAuto: "자동" / "Auto"
  </action>
  <verify>
1. npm run build 성공
2. 브라우저에서 헤더에 이름 표시 토글 확인
3. EN/KO/Auto 전환 시 최애 목록 이름 변경 확인
  </verify>
  <done>
- Header에 NameLanguageToggle 표시됨
- BiasManager에서 언어 모드에 따라 이름 표시
- 빌드 성공, 런타임 에러 없음
  </done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `npm run build` 성공
- [ ] NameLanguageToggle이 Header에 표시됨
- [ ] EN/KO/Auto 전환 시 최애 목록 이름이 해당 언어로 변경됨
- [ ] localStorage에 설정 저장되어 새로고침 후에도 유지됨
- [ ] TypeScript 에러 없음
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No errors or warnings introduced
- 이름 표시 언어 토글이 작동함
- Phase 12 complete
  </success_criteria>

<output>
After completion, create `.planning/phases/12-language-toggle-ui/12-01-SUMMARY.md`:

# Phase 12 Plan 01: Language Toggle UI Summary

**[Substantive one-liner]**

## Accomplishments

- [Key outcome 1]
- [Key outcome 2]

## Files Created/Modified

- `path/to/file.ts` - Description

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Phase Readiness

[Ready for Phase 13: Enhanced Tag Matching]
</output>
