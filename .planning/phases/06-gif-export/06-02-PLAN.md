---
phase: 06-gif-export
plan: 02
type: execute
depends_on: []
files_modified: [src/lib/export.ts, src/app/api/export/route.ts, src/components/ExportModal.tsx, src/components/Sidebar.tsx]
---

<objective>
JSON 형식 데이터 내보내기/가져오기 기능

Purpose: 아카이브 데이터를 JSON으로 백업하고 복원할 수 있도록 함
Output: 전체 데이터 내보내기/가져오기 기능 + UI
</objective>

<execution_context>
./.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/lib/links.ts
@src/lib/biases.ts
@src/lib/tags.ts
@src/types/database.ts

**Tech available:** Next.js 16, React 19, Supabase, TailwindCSS
**Established patterns:** API routes in src/app/api/, 유틸은 src/lib/
**DB schema:** links, link_media, tags, link_tags, biases
</context>

<tasks>

<task type="auto">
  <name>Task 1: 내보내기/가져오기 유틸 및 API</name>
  <files>src/lib/export.ts, src/app/api/export/route.ts, src/app/api/import/route.ts</files>
  <action>
1. src/lib/export.ts 생성:
   - ExportData 타입 정의:
     ```typescript
     interface ExportData {
       version: string;  // "1.0"
       exportedAt: string;  // ISO timestamp
       biases: Bias[];
       tags: Tag[];
       links: LinkWithTagsAndMedia[];
     }
     ```
   - exportAllData(): Promise<ExportData> - 모든 데이터 조회 및 구조화
   - validateImportData(data: unknown): ExportData | null - JSON 유효성 검증
   - importData(data: ExportData): Promise<ImportResult> - 데이터 가져오기
     - 중복 처리: 동일 URL은 스킵, biases/tags는 이름으로 매칭
     - ImportResult: { imported: number, skipped: number, errors: string[] }

2. src/app/api/export/route.ts 생성:
   - GET: exportAllData() 호출, JSON 응답 (Content-Disposition: attachment)

3. src/app/api/import/route.ts 생성:
   - POST: JSON body 받아서 validateImportData → importData
   - 에러 처리 및 결과 반환

주의: 가져오기 시 기존 데이터 유지 (덮어쓰기 X), 새 데이터만 추가
  </action>
  <verify>npm run build 성공, GET /api/export가 JSON 반환</verify>
  <done>내보내기/가져오기 API 작동, 데이터 직렬화/역직렬화 완료</done>
</task>

<task type="auto">
  <name>Task 2: 내보내기/가져오기 UI</name>
  <files>src/components/ExportModal.tsx, src/components/Sidebar.tsx</files>
  <action>
1. src/components/ExportModal.tsx 생성:
   - 모달 형태 (isOpen, onClose props)
   - 두 탭: "내보내기" / "가져오기"

   내보내기 탭:
   - "JSON 다운로드" 버튼
   - 클릭 시 /api/export 호출 → Blob → 다운로드 (bias-archive-backup-YYYYMMDD.json)
   - 통계 표시 (N개 링크, M개 태그 등)

   가져오기 탭:
   - 파일 업로드 영역
   - 미리보기: 가져올 데이터 요약 (링크 수, 태그 수 등)
   - "가져오기" 버튼
   - 결과 표시: N개 추가, M개 스킵, 에러 목록

2. src/components/Sidebar.tsx 수정:
   - 하단에 "데이터 관리" 버튼 추가 (아이콘: 다운로드/업로드)
   - 클릭 시 ExportModal 열기

다크모드 지원, 기존 UI 스타일과 일관성 유지
  </action>
  <verify>npm run build 성공, Sidebar에서 ExportModal 열기 가능</verify>
  <done>내보내기 → JSON 다운로드 가능, 가져오기 → 파일 업로드 및 처리 완료</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] npm run build 성공
- [ ] GET /api/export가 JSON 반환
- [ ] JSON 파일 다운로드 작동
- [ ] JSON 파일 업로드 및 가져오기 작동
- [ ] 중복 데이터 스킵 처리
- [ ] 다크모드 지원
</verification>

<success_criteria>
- 전체 아카이브 데이터를 JSON으로 내보내기 가능
- JSON 파일을 가져와서 데이터 복원 가능
- 중복 처리 로직 작동
- UI에서 내보내기/가져오기 접근 가능
</success_criteria>

<output>
After completion, create `.planning/phases/06-gif-export/06-02-SUMMARY.md`
</output>
