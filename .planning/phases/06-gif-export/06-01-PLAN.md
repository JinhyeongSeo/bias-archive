---
phase: 06-gif-export
plan: 01
type: execute
depends_on: []
files_modified: [src/lib/ffmpeg.ts, src/components/GifMaker.tsx, src/app/gif/page.tsx]
---

<objective>
FFmpeg.wasm 기반 브라우저 GIF 생성기 구현

Purpose: 영상에서 구간을 선택해 GIF로 변환하는 기능 제공 (서버 없이 브라우저에서 처리)
Output: /gif 페이지에서 로컬 파일 또는 URL로 GIF 생성 가능
</objective>

<execution_context>
./.claude/get-shit-done/workflows/execute-plan.md
./summary.md
./.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/app/layout.tsx
@src/components/Sidebar.tsx

**Tech available:** Next.js 16, React 19, Supabase, TailwindCSS, next-themes
**Established patterns:** 컴포넌트는 src/components/, API는 src/app/api/, 유틸은 src/lib/
**Research findings:**
- @ffmpeg/ffmpeg + @ffmpeg/core 설치
- ffmpeg.wasm은 MEMFS 사용 (writeFile → run → readFile)
- GIF 변환: `ffmpeg.run('-i', 'input', '-t', duration, '-ss', start, '-f', 'gif', 'out.gif')`
- 결과를 Blob으로 변환해 다운로드 제공
</context>

<tasks>

<task type="auto">
  <name>Task 1: FFmpeg.wasm 설정 및 유틸 함수</name>
  <files>src/lib/ffmpeg.ts</files>
  <action>
1. @ffmpeg/ffmpeg @ffmpeg/core 패키지 설치 (npm install)
2. src/lib/ffmpeg.ts 생성:
   - loadFFmpeg(): FFmpeg 인스턴스 로드 (싱글톤 패턴)
   - convertToGif(file: File, startTime: number, duration: number): Promise<Blob>
     - ffmpeg.writeFile로 입력 파일 저장
     - ffmpeg.exec로 GIF 변환 실행 (-ss startTime -t duration -vf "fps=10,scale=320:-1:flags=lanczos")
     - ffmpeg.readFile로 결과 읽기
     - Blob으로 변환해 반환
   - 진행률 콜백 지원 (ffmpeg.on('progress'))
3. 타입 정의: GifOptions (startTime, duration, fps, width)

주의: @ffmpeg/ffmpeg v0.12+는 createFFmpeg 대신 FFmpeg 클래스 사용
주의: SharedArrayBuffer 필요 시 단일 스레드 버전 사용 (브라우저 호환성)
  </action>
  <verify>npm run build 성공, TypeScript 에러 없음</verify>
  <done>FFmpeg 유틸 함수 작성 완료, loadFFmpeg/convertToGif 함수 export</done>
</task>

<task type="auto">
  <name>Task 2: GIF 생성기 UI 컴포넌트</name>
  <files>src/components/GifMaker.tsx, src/app/gif/page.tsx</files>
  <action>
1. src/components/GifMaker.tsx 생성:
   - 파일 업로드 영역 (drag & drop 지원)
   - 비디오 미리보기 (video 태그)
   - 시작 시간 / 지속 시간 입력 (range slider 또는 input)
   - "GIF 생성" 버튼
   - 진행률 표시 (로딩 바)
   - 결과 GIF 미리보기 및 다운로드 버튼
   - 에러 처리 (FFmpeg 로드 실패, 변환 실패 등)

2. src/app/gif/page.tsx 생성:
   - 페이지 제목 "GIF 생성기"
   - GifMaker 컴포넌트 렌더링
   - 다크모드 지원

3. src/components/Sidebar.tsx 수정:
   - Navigation에 "/gif" 링크 추가 (아이콘: 필름 또는 GIF 아이콘)

UI 스타일: 기존 컴포넌트와 일관된 TailwindCSS 스타일, 다크모드 지원
  </action>
  <verify>npm run build 성공, /gif 페이지 접근 가능</verify>
  <done>/gif 페이지에서 로컬 파일 업로드 → GIF 변환 → 다운로드 가능</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>FFmpeg.wasm 기반 GIF 생성기</what-built>
  <how-to-verify>
    1. npm run dev 실행
    2. http://localhost:3000/gif 접속
    3. 짧은 비디오 파일 (5초 이하) 업로드
    4. 시작 시간 0초, 지속 시간 2초로 설정
    5. "GIF 생성" 버튼 클릭
    6. 진행률 표시 확인
    7. 생성된 GIF 미리보기 확인
    8. "다운로드" 클릭해서 GIF 파일 저장
    9. 다크모드 전환 후 UI 확인
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] npm run build 성공
- [ ] /gif 페이지 접근 가능
- [ ] 로컬 비디오 → GIF 변환 작동
- [ ] 진행률 표시 작동
- [ ] GIF 다운로드 작동
- [ ] 다크모드 지원
</verification>

<success_criteria>
- FFmpeg.wasm 설정 완료
- GIF 생성기 UI 구현
- 로컬 파일에서 GIF 생성 및 다운로드 가능
- 사용자 검증 통과
</success_criteria>

<output>
After completion, create `.planning/phases/06-gif-export/06-01-SUMMARY.md`
</output>
