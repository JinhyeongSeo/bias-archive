---
phase: 31-external-search-pagination
plan: 01
type: execute
depends_on: []
files_modified: [src/components/UnifiedSearch.tsx]
---

<objective>
heye, kgirls, kgirls-issue 외부 검색에서 캐시 20개 이후에도 자연스럽게 추가 결과 로딩되도록 수정

Purpose: 현재 캐시 소진 시 "더보기" 버튼 클릭해도 결과가 없거나 오류가 발생하는 문제 해결
Output: heye/kgirls/kgirls-issue 플랫폼에서 무한 스크롤이 자연스럽게 동작, 페이지 정보 표시
</objective>

<execution_context>
./.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/components/UnifiedSearch.tsx
@src/lib/searchCache.ts

**현재 구현:**
- API_FETCH_COUNT = 20 (API 호출당 20개 fetch)
- RESULTS_PER_PLATFORM = 4 (화면에 4개씩 표시)
- 더보기 시 캐시 확인 → 부족하면 다음 페이지 API 호출

**문제점:**
- 캐시 소진 후 "더보기" 클릭 시 결과가 0으로 표시되는 문제
- 원인: 캐시된 `currentPage` 값이 제대로 전달/저장되지 않아 항상 1페이지만 요청
- hasMore 플래그가 잘못 계산될 수 있음

**해결 방향:**
- 캐시에서 currentPage 값을 올바르게 읽어와 다음 페이지 계산
- 페이지 정보를 UI에 표시하여 사용자에게 진행 상황 안내
- selca와 동일한 패턴으로 일관성 있는 UX 제공
</context>

<tasks>

<task type="auto">
  <name>Task 1: heye/kgirls/kgirls-issue 더보기 로직에서 currentPage 올바르게 사용</name>
  <files>src/components/UnifiedSearch.tsx</files>
  <action>
handleLoadMore 함수에서 heye, kgirls, kgirls-issue 케이스 수정:

1. 캐시에서 currentPage 읽어오기:
   - `newPage = (heyeCache?.currentPage ?? currentData.currentPage) + 1`로 수정
   - 캐시의 currentPage가 있으면 그것 사용, 없으면 currentData.currentPage 사용

2. 검색 결과 헤더에 페이지 정보 표시:
   - 플랫폼 카드 헤더 영역에 `(페이지 N)` 형태로 현재 페이지 표시
   - selca처럼 `selcaPage` state 대신, `currentPage` 값 활용

3. 캐시 업데이트 시 currentPage 올바르게 저장:
   - 현재 코드 검증: `currentPage: newPage`가 올바르게 저장되는지 확인
   - 필요시 수정

**주의:**
- 기존 selca 로직(max_time_id 기반)은 건드리지 않음
- heye, kgirls, kgirls-issue만 수정
  </action>
  <verify>
1. UnifiedSearch에서 heye 검색 후 "더보기" 5회 이상 클릭해도 결과가 계속 로드됨
2. kgirls, kgirls-issue도 동일하게 동작
3. 페이지 정보가 UI에 표시됨
  </verify>
  <done>
- heye/kgirls/kgirls-issue에서 20개 이상 결과 로드 가능
- 더보기 시 다음 페이지가 올바르게 fetch됨
- 현재 페이지 정보가 UI에 표시됨
  </done>
</task>

<task type="auto">
  <name>Task 2: 플랫폼별 페이지 정보 UI 표시</name>
  <files>src/components/UnifiedSearch.tsx</files>
  <action>
각 플랫폼 결과 카드에 페이지 정보 표시:

1. PlatformResults 인터페이스에 totalPages 추가 (optional):
   ```typescript
   interface PlatformResults {
     // ... existing fields
     totalPages?: number  // 전체 페이지 수 (heye, kgirls용)
   }
   ```

2. searchHeye, searchKgirls, searchKgirlsIssue 함수에서 totalPages 반환:
   - 이미 API가 `totalPages` 반환하므로 그대로 사용

3. 플랫폼 헤더 영역에 페이지 정보 표시:
   - heye: "heye.kr (N/M 페이지)" 또는 "heye.kr (페이지 N)"
   - selca와 유사한 스타일로 표시

4. hasMore가 true일 때만 "더보기" 버튼 표시 (기존 동작 유지)

**UI 스타일:**
- 기존 플랫폼 라벨 옆에 작은 텍스트로 페이지 정보 표시
- text-xs text-zinc-500 스타일 사용
  </action>
  <verify>
1. heye 검색 결과에 "(페이지 N)" 형태로 표시됨
2. kgirls, kgirls-issue도 동일하게 표시됨
3. 더보기 클릭 시 페이지 번호가 증가함
  </verify>
  <done>
- 플랫폼 헤더에 현재 페이지 정보 표시
- 사용자가 검색 진행 상황 파악 가능
  </done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] heye에서 20개 이상 결과 로드 테스트 (더보기 5회 이상)
- [ ] kgirls에서 20개 이상 결과 로드 테스트
- [ ] kgirls-issue에서 20개 이상 결과 로드 테스트
- [ ] 페이지 정보가 UI에 올바르게 표시됨
- [ ] `npm run build` 성공
</verification>

<success_criteria>

- 모든 태스크 완료
- heye, kgirls, kgirls-issue에서 캐시 20개 이후에도 더보기 정상 동작
- 페이지 정보가 UI에 표시됨
- 빌드 오류 없음
</success_criteria>

<output>
After completion, create `.planning/phases/31-external-search-pagination/31-01-SUMMARY.md`:

# Phase 31 Plan 01: External Search Pagination Summary

**heye/kgirls/kgirls-issue 페이지네이션 수정 완료**

## Accomplishments

- heye, kgirls, kgirls-issue 더보기 로직에서 currentPage 올바르게 사용
- 플랫폼 헤더에 페이지 정보 표시
- 캐시 20개 이후에도 자연스럽게 추가 결과 로딩

## Files Created/Modified

- `src/components/UnifiedSearch.tsx` - 더보기 로직 수정, 페이지 정보 UI 추가

## Decisions Made

[Key decisions and rationale]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Phase complete, ready for next phase
</output>
