---
phase: 08-heye-parser
plan: 01
type: execute
depends_on: []
files_modified: [src/lib/parsers/heye.ts, src/lib/parsers/index.ts, src/lib/metadata.ts]
---

<objective>
heye.kr 커뮤니티 게시판에서 이미지/GIF 추출하는 파서 모듈을 추가한다.

Purpose: heye.kr은 한국 연예인 관련 콘텐츠가 많은 커뮤니티로, 직캠/팬캠 관련 이미지와 GIF가 많이 공유됨. OG 메타데이터가 없어 커스텀 HTML 파싱 필요.
Output: heye.kr URL 입력 시 제목, 작성자, 날짜, 모든 이미지/GIF URL을 자동 추출
</objective>

<execution_context>
./.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@src/lib/parsers/index.ts
@src/lib/parsers/generic.ts
@src/lib/metadata.ts

**heye.kr 사이트 분석 결과:**
- 게시글 본문: `#div_content` selector
- 이미지 URL 패턴: `https://img1.heye.kr/image/idol/YYYY/MM/[timestamp].jpeg`
- 제목: `<title>` 태그에서 추출
- 날짜: "등록일: YY-MM-DD" 패턴으로 텍스트에서 추출
- 작성자: 레벨 아이콘 근처 텍스트
- OG 메타데이터: 없음 (커스텀 파싱 필수)

**기존 파서 패턴:**
- `parseGeneric`, `parseTwitter` 등과 동일한 인터페이스
- `VideoMetadata` 타입 반환
- `media` 배열로 다중 이미지 지원
</context>

<tasks>

<task type="auto">
  <name>Task 1: heye.kr 파서 모듈 생성</name>
  <files>src/lib/parsers/heye.ts</files>
  <action>
heye.kr URL을 파싱하는 전용 파서 모듈을 생성한다.

구현 사항:
1. HTML 페이지 fetch (User-Agent 헤더 필수)
2. cheerio 라이브러리로 HTML 파싱 (node-html-parser 또는 cheerio 사용)
3. `<title>` 태그에서 제목 추출
4. "등록일: YY-MM-DD" 패턴으로 날짜 추출 (정규식 사용)
5. `#div_content` 내 모든 `<img>` 태그에서 src 추출
6. 이미지 URL이 상대 경로일 경우 절대 경로로 변환
7. 첫 번째 이미지를 thumbnailUrl로, 나머지는 media 배열에 포함
8. .gif 확장자는 type: 'gif', 그 외는 type: 'image'

에러 처리:
- 페이지 로드 실패 시 기본값 반환 (title: URL, 나머지 null)
- 이미지가 없을 경우 thumbnailUrl: null, media: []

**주의**: cheerio가 설치되어 있지 않으면 `npm install cheerio` 필요
  </action>
  <verify>TypeScript 컴파일 에러 없음: `npx tsc --noEmit`</verify>
  <done>heye.ts 파일이 VideoMetadata 타입을 반환하는 parseHeye 함수를 export</done>
</task>

<task type="auto">
  <name>Task 2: 플랫폼 통합 및 라우팅</name>
  <files>src/lib/parsers/index.ts, src/lib/metadata.ts</files>
  <action>
heye.kr 파서를 기존 파서 시스템에 통합한다.

1. `src/lib/parsers/index.ts`:
   - Platform 타입에 'heye' 추가
   - `export { parseHeye } from './heye'` 추가

2. `src/lib/metadata.ts`:
   - `detectPlatform` 함수에 heye.kr 감지 로직 추가
   - hostname이 'heye.kr' 포함 시 'heye' 반환
   - `getParser` 함수에 heye 케이스 추가

패턴 참고:
```typescript
// detectPlatform
if (hostname.includes('heye.kr')) {
  return 'heye'
}

// getParser
case 'heye':
  return parseHeye
```
  </action>
  <verify>`npm run build` 성공</verify>
  <done>heye.kr URL이 parseHeye 함수로 라우팅됨</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>heye.kr 파서 모듈 및 플랫폼 통합</what-built>
  <how-to-verify>
    1. Run: `npm run dev`
    2. Visit: http://localhost:3000
    3. 링크 추가 입력창에 다음 URL 입력:
       `https://www.heye.kr/board/index.html?id=idol&no=95835`
    4. 확인:
       - 제목이 추출되어 표시됨
       - 썸네일 이미지가 표시됨
       - 작성자/날짜 정보 표시됨 (있으면)
    5. 저장 후 목록에서:
       - 카드에 이미지 표시됨
       - 뷰어에서 모든 이미지 확인 가능 (link_media)
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `npm run build` 에러 없음
- [ ] heye.kr URL 입력 시 메타데이터 추출됨
- [ ] 제목, 썸네일 표시됨
- [ ] 다중 이미지가 media 배열로 저장됨
</verification>

<success_criteria>

- heye.kr 파서 모듈 생성됨
- 플랫폼 감지 및 라우팅 통합됨
- heye.kr URL에서 이미지/GIF 추출 가능
- 기존 파서와 동일한 인터페이스 유지
  </success_criteria>

<output>
After completion, create `.planning/phases/08-heye-parser/08-01-SUMMARY.md`:

# Phase 8 Plan 1: heye.kr Parser Summary

**[한 줄 요약]**

## Accomplishments

- heye.kr 파서 모듈 생성
- 플랫폼 통합 완료

## Files Created/Modified

- `src/lib/parsers/heye.ts` - heye.kr 전용 파서
- `src/lib/parsers/index.ts` - Platform 타입 및 export
- `src/lib/metadata.ts` - 플랫폼 감지 및 라우팅

## Decisions Made

[결정 사항]

## Issues Encountered

[발생한 이슈]

## Next Step

Phase 8 complete - heye.kr 지원 추가됨
</output>
