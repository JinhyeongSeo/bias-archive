---
phase: 08-heye-parser
plan: 02
type: execute
depends_on: ["08-01"]
files_modified: [src/app/api/search/heye/route.ts, src/components/ExternalSearch.tsx, src/lib/parsers/index.ts]
---

<objective>
heye.kr 커뮤니티에서 키워드로 게시글을 검색하는 기능을 추가한다.

Purpose: 기존 YouTube/Twitter 검색처럼 heye.kr에서도 키워드 검색 → 결과 미리보기 → 저장 흐름 지원
Output: 외부 검색 모달에 heye.kr 탭 추가, 검색 결과에서 바로 저장 가능
</objective>

<execution_context>
./.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/08-heye-parser/08-01-PLAN.md
@src/components/ExternalSearch.tsx
@src/lib/parsers/heye.ts (08-01에서 생성됨)

**heye.kr 검색 파라미터:**
- `id=idol` (게시판 ID)
- `sfl=wr_subject` (검색 필드: 제목)
- `stx=검색어` (검색어)
- 결과: 30개/페이지

**기존 검색 패턴:**
- `/api/youtube/search` - YouTube Data API
- `/api/search/twitter` - Google CSE
- ExternalSearch.tsx에서 플랫폼별 검색 함수 호출
</context>

<tasks>

<task type="auto">
  <name>Task 1: heye.kr 검색 API 라우트 생성</name>
  <files>src/app/api/search/heye/route.ts</files>
  <action>
heye.kr 검색 결과를 가져오는 API 엔드포인트를 생성한다.

구현 사항:
1. GET /api/search/heye?q=검색어
2. heye.kr 검색 URL 호출: `https://www.heye.kr/board/index.html?id=idol&sfl=wr_subject&stx=${encodeURIComponent(query)}`
3. cheerio로 HTML 파싱:
   - 게시글 목록에서 각 항목의 링크(no 파라미터), 제목, 썸네일 추출
   - 결과 패턴: `./index.html?id=idol&no=12345`
4. 상위 10개만 반환 (검색 속도 위해)
5. 각 결과를 `{ url, title, thumbnailUrl, author }` 형태로 반환

에러 처리:
- 네트워크 오류 시 500 + error message
- 결과 없을 시 빈 배열 반환

반환 타입:
```typescript
interface HeyeSearchResult {
  url: string      // https://www.heye.kr/board/index.html?id=idol&no=12345
  title: string
  thumbnailUrl: string | null
  author: string
}
```
  </action>
  <verify>`curl "http://localhost:3000/api/search/heye?q=카리나"` 가 JSON 배열 반환</verify>
  <done>검색 API가 heye.kr 검색 결과를 JSON으로 반환</done>
</task>

<task type="auto">
  <name>Task 2: ExternalSearch에 heye.kr 탭 추가</name>
  <files>src/components/ExternalSearch.tsx, src/lib/parsers/index.ts</files>
  <action>
외부 검색 모달에 heye.kr 플랫폼을 추가한다.

1. `src/lib/parsers/index.ts`:
   - Platform 타입에 'heye' 추가 (08-01에서 이미 추가됨, 확인만)

2. `src/components/ExternalSearch.tsx`:
   - Platform 타입에 'heye' 추가
   - 플랫폼 선택 버튼 추가 (오렌지색 테마)
   - searchHeye 함수 추가:
     ```typescript
     const searchHeye = async (searchQuery: string): Promise<EnrichedResult[]> => {
       const response = await fetch(`/api/search/heye?q=${encodeURIComponent(searchQuery)}`)
       // ... 결과 매핑
     }
     ```
   - handleSearch에서 platform === 'heye' 케이스 추가
   - 결과 카드에 heye 플랫폼 뱃지 스타일 추가 (오렌지색)

UI 스타일:
- 버튼: bg-orange-100 dark:bg-orange-900/50 text-orange-700 dark:text-orange-300
- 뱃지: 같은 오렌지 테마
  </action>
  <verify>`npm run build` 성공</verify>
  <done>외부 검색 모달에 heye.kr 탭이 표시되고 검색 가능</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>heye.kr 검색 기능</what-built>
  <how-to-verify>
    1. Run: `npm run dev`
    2. Visit: http://localhost:3000
    3. 사이드바에서 "외부 검색" 버튼 클릭
    4. heye.kr 탭 선택
    5. "카리나" 검색
    6. 확인:
       - 검색 결과 목록 표시됨
       - 각 결과에 제목, 썸네일 표시됨
       - "저장" 버튼 클릭 시 아카이브에 추가됨
       - 저장된 항목은 "저장됨" 뱃지 표시
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `npm run build` 에러 없음
- [ ] /api/search/heye API가 검색 결과 반환
- [ ] 외부 검색 모달에 heye.kr 탭 표시
- [ ] heye.kr 검색 후 결과 저장 가능
</verification>

<success_criteria>

- heye.kr 검색 API 생성됨
- ExternalSearch에 heye.kr 탭 추가됨
- 검색 → 미리보기 → 저장 플로우 완성
- 기존 YouTube/Twitter 검색과 일관된 UX
  </success_criteria>

<output>
After completion, create `.planning/phases/08-heye-parser/08-02-SUMMARY.md`:

# Phase 8 Plan 2: heye.kr Search Summary

**[한 줄 요약]**

## Accomplishments

- heye.kr 검색 API 생성
- ExternalSearch heye.kr 탭 추가

## Files Created/Modified

- `src/app/api/search/heye/route.ts` - 검색 API
- `src/components/ExternalSearch.tsx` - heye.kr 탭

## Decisions Made

[결정 사항]

## Issues Encountered

[발생한 이슈]

## Next Step

Phase 8 complete - heye.kr 파서 및 검색 기능 완성
</output>
