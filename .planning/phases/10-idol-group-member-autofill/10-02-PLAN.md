---
phase: 10-idol-group-member-autofill
plan: 02
type: execute
depends_on: ["10-01"]
files_modified: [src/app/api/kpop/groups/[id]/members/route.ts, src/app/api/biases/batch/route.ts, src/components/BiasManager.tsx]
---

<objective>
BiasManager에 그룹 자동완성 UI를 추가하고, 그룹 선택 시 모든 멤버를 최애 목록에 일괄 추가하는 기능을 구현한다.

Purpose: 사용자가 그룹명만 입력하면 해당 그룹의 모든 멤버가 자동으로 최애 목록에 추가됨
Output: 그룹 자동완성 UI + 멤버 일괄 추가 완료
</objective>

<execution_context>
./.claude/get-shit-done/workflows/execute-plan.md
./summary.md
./.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-idol-group-member-autofill/10-01-SUMMARY.md

@src/components/BiasManager.tsx
@src/lib/kpop-data.ts
@src/app/api/biases/route.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: 그룹 멤버 조회 API 엔드포인트 생성</name>
  <files>src/app/api/kpop/groups/[id]/members/route.ts</files>
  <action>
GET /api/kpop/groups/[id]/members 엔드포인트 구현:

1. URL 파라미터로 그룹 ID 받음
2. getGroupMembers 호출하여 멤버 목록 반환
3. 결과 형식: { groupName, groupNameOriginal, members: KpopMember[] }
4. 그룹 없으면 404 반환

이 API는 사용자가 그룹을 선택했을 때 해당 그룹의 멤버 목록을 가져오는 데 사용됨.
  </action>
  <verify>curl "http://localhost:3000/api/kpop/groups/{IVE_GROUP_ID}/members"로 멤버 목록 확인</verify>
  <done>IVE 그룹 ID로 조회 시 6명 멤버 정보 반환 (유진, 가을, 리즈, 원영, 레이, 이서)</done>
</task>

<task type="auto">
  <name>Task 2: 최애 일괄 추가 API 엔드포인트 생성</name>
  <files>src/app/api/biases/batch/route.ts</files>
  <action>
POST /api/biases/batch 엔드포인트 구현:

Request body: { members: { name: string, groupName: string }[] }

1. members 배열의 각 항목에 대해 bias 생성
2. Supabase insert를 한 번에 처리 (batch insert)
3. 이미 존재하는 name+group_name 조합은 무시 (upsert 대신 중복 체크 후 필터링)
4. 결과: { added: number, skipped: number }

중복 처리: 기존 biases에서 동일한 name이 있으면 해당 항목은 추가하지 않음 (같은 멤버 이름이 다른 그룹에 있을 수 있으므로 name으로만 체크).
  </action>
  <verify>POST /api/biases/batch로 IVE 멤버 6명 추가 후 결과 확인</verify>
  <done>added, skipped 카운트가 정확히 반환됨</done>
</task>

<task type="auto">
  <name>Task 3: BiasManager에 그룹 자동완성 UI 추가</name>
  <files>src/components/BiasManager.tsx</files>
  <action>
BiasManager 컴포넌트 확장:

1. "그룹으로 추가" 버튼 추가 (기존 "최애 추가" 버튼 옆)
2. 클릭 시 그룹 검색 모드로 전환
3. 그룹명 입력 시 /api/kpop/groups?q= 호출하여 자동완성 목록 표시
4. 드롭다운에서 그룹 선택 시:
   a. /api/kpop/groups/{id}/members 호출
   b. 멤버 목록 미리보기 표시 (체크박스로 개별 선택 가능)
   c. "추가" 버튼 클릭 시 /api/biases/batch 호출
5. 추가 완료 후 onBiasAdded() 콜백 호출

UI 상태:
- isGroupMode: boolean (그룹 추가 모드 여부)
- groupQuery: string (검색어)
- groupResults: KpopGroup[] (검색 결과)
- selectedGroup: { id, name, nameOriginal } | null
- groupMembers: KpopMember[] (선택된 그룹의 멤버)
- selectedMembers: Set<string> (선택된 멤버 ID들)

디바운스: 검색어 입력 시 300ms 디바운스 적용하여 API 호출 최소화
  </action>
  <verify>npm run dev 후 사이드바에서 그룹 자동완성 테스트</verify>
  <done>그룹 검색 → 선택 → 멤버 미리보기 → 일괄 추가 플로우 작동</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>그룹 자동완성 및 멤버 일괄 추가 기능</what-built>
  <how-to-verify>
    1. npm run dev 실행
    2. 사이드바에서 "그룹으로 추가" 버튼 클릭
    3. "IVE" 또는 "아이브" 입력하여 자동완성 확인
    4. 그룹 선택 시 멤버 목록 미리보기 확인 (유진, 가을, 리즈, 원영, 레이, 이서)
    5. "추가" 클릭하여 최애 목록에 일괄 추가 확인
    6. 추가된 멤버들이 사이드바에 표시되는지 확인
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] npm run build 성공
- [ ] 그룹 검색 API 작동
- [ ] 멤버 조회 API 작동
- [ ] 일괄 추가 API 작동
- [ ] UI에서 전체 플로우 테스트 통과
</verification>

<success_criteria>

- 그룹명(영어/한글) 자동완성 작동
- 그룹 선택 시 멤버 미리보기 표시
- 선택한 멤버들 일괄 추가 성공
- 중복 멤버는 자동으로 스킵됨
- Phase 10 complete
</success_criteria>

<output>
After completion, create `.planning/phases/10-idol-group-member-autofill/10-02-SUMMARY.md`:

# Phase 10 Plan 02: 그룹 자동완성 UI 및 일괄 추가 Summary

**[요약 작성]**

## Accomplishments

- [Key outcome 1]
- [Key outcome 2]

## Files Created/Modified

- `src/app/api/kpop/groups/[id]/members/route.ts` - 멤버 조회 API
- `src/app/api/biases/batch/route.ts` - 일괄 추가 API
- `src/components/BiasManager.tsx` - 그룹 자동완성 UI

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Phase 10 complete, ready for next milestone
</output>
