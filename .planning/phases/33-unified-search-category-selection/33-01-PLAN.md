---
phase: 33-unified-search-category-selection
plan: 01
type: execute
depends_on: []
files_modified: [src/components/UnifiedSearch.tsx]
---

<objective>
통합 검색에서 카테고리(플랫폼)별 선택 기능 추가

Purpose: 현재 "전체 선택/해제"만 가능한 UI를 개선하여 플랫폼별로 결과를 일괄 선택/해제할 수 있게 함
Output: 플랫폼 헤더에 선택 버튼이 추가되고, 해당 플랫폼의 저장 안 된 결과만 일괄 선택 가능
</objective>

<execution_context>
./.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/components/UnifiedSearch.tsx

**Tech stack:**
- React 19, Next.js 16
- TypeScript
- framer-motion (애니메이션)
- Tailwind CSS 4

**현재 구조:**
- `selectedUrls: Set<string>` - 선택된 URL 세트
- `selectableResults` - 저장 안 된 결과만 필터링
- `selectAll()` / `clearSelection()` - 전체 선택/해제
- `PLATFORMS` 배열에 6개 플랫폼 정의
- 각 결과에 `platform` 필드로 플랫폼 구분
- 플랫폼 헤더 UI 존재 (라인 2640-2685)

**핵심 로직 (라인 1914-1924):**
```typescript
const selectableResults = allResults.filter((r) => !r.isSaved);
const selectableCount = selectableResults.length;
const selectedCount = selectedUrls.size;

const selectAll = () => {
  setSelectedUrls(new Set(selectableResults.map((r) => r.url)));
};

const clearSelection = () => {
  setSelectedUrls(new Set());
};
```
</context>

<tasks>

<task type="auto">
  <name>Task 1: 플랫폼별 선택 헬퍼 함수 추가</name>
  <files>src/components/UnifiedSearch.tsx</files>
  <action>
기존 selectAll/clearSelection 함수 근처(라인 1918-1924)에 플랫폼별 선택 함수들 추가:

```typescript
// 특정 플랫폼의 선택 가능한 결과 가져오기
const getSelectableByPlatform = (platform: Platform) => {
  return selectableResults.filter((r) => r.platform === platform);
};

// 특정 플랫폼의 선택된 개수 가져오기
const getSelectedCountByPlatform = (platform: Platform) => {
  return selectableResults.filter(
    (r) => r.platform === platform && selectedUrls.has(r.url)
  ).length;
};

// 특정 플랫폼 전체 선택
const selectByPlatform = (platform: Platform) => {
  const platformResults = getSelectableByPlatform(platform);
  setSelectedUrls((prev) => {
    const next = new Set(prev);
    platformResults.forEach((r) => next.add(r.url));
    return next;
  });
};

// 특정 플랫폼 전체 해제
const deselectByPlatform = (platform: Platform) => {
  const platformResults = getSelectableByPlatform(platform);
  setSelectedUrls((prev) => {
    const next = new Set(prev);
    platformResults.forEach((r) => next.delete(r.url));
    return next;
  });
};

// 플랫폼 선택 토글 (전체 선택 ↔ 전체 해제)
const togglePlatformSelection = (platform: Platform) => {
  const selectable = getSelectableByPlatform(platform);
  const selectedInPlatform = getSelectedCountByPlatform(platform);

  if (selectedInPlatform === selectable.length && selectable.length > 0) {
    deselectByPlatform(platform);
  } else {
    selectByPlatform(platform);
  }
};
```

함수들을 기존 selectAll/clearSelection 바로 아래에 추가.
  </action>
  <verify>TypeScript 컴파일 에러 없음: npm run build (타입 체크만)</verify>
  <done>플랫폼별 선택 함수들이 추가되고, 타입 에러 없음</done>
</task>

<task type="auto">
  <name>Task 2: 플랫폼 헤더에 선택 버튼 UI 추가</name>
  <files>src/components/UnifiedSearch.tsx</files>
  <action>
플랫폼 헤더 영역(라인 2640-2685)을 수정하여 각 플랫폼 옆에 선택 버튼 추가:

현재 구조:
```tsx
<div className="flex items-center justify-between">
  <div className="flex items-center gap-2">
    <span className={...}>{platformConfig.label}</span>
    {/* 로딩 스피너 또는 결과 개수 */}
  </div>
</div>
```

수정 후:
```tsx
<div className="flex items-center justify-between">
  <div className="flex items-center gap-2">
    <span className={...}>{platformConfig.label}</span>
    {/* 로딩 스피너 또는 결과 개수 */}
  </div>

  {/* 플랫폼별 선택 버튼 - 선택 가능한 결과가 있을 때만 표시 */}
  {(() => {
    const selectable = getSelectableByPlatform(platformConfig.id);
    const selectedInPlatform = getSelectedCountByPlatform(platformConfig.id);
    if (selectable.length === 0) return null;

    const isAllSelected = selectedInPlatform === selectable.length;

    return (
      <div className="flex items-center gap-1.5">
        {selectedInPlatform > 0 && (
          <span className="text-xs text-primary">
            {selectedInPlatform}개
          </span>
        )}
        <motion.button
          onClick={(e) => {
            e.stopPropagation();
            togglePlatformSelection(platformConfig.id);
          }}
          className={`px-2 py-0.5 text-xs rounded transition-colors ${
            isAllSelected
              ? 'bg-primary/10 text-primary'
              : 'bg-zinc-100 dark:bg-zinc-700 text-zinc-500 dark:text-zinc-400 hover:bg-zinc-200 dark:hover:bg-zinc-600'
          }`}
          {...pressScale}
        >
          {isAllSelected ? '해제' : '선택'}
        </motion.button>
      </div>
    );
  })()}
</div>
```

버튼 스타일은 기존 "전체 선택" 버튼과 유사하되 더 작게 (text-xs, px-2, py-0.5).
플랫폼 색상 테마를 활용하여 선택 상태 표시.
  </action>
  <verify>
1. npm run dev 실행 후 http://localhost:3000에서 통합 검색 열기
2. 아이돌 선택 후 검색 실행
3. 각 플랫폼 헤더 옆에 "선택" 버튼 표시 확인
4. 버튼 클릭 시 해당 플랫폼 결과만 선택됨 확인
5. 다시 클릭 시 해제됨 확인
  </verify>
  <done>
- 각 플랫폼 헤더에 선택 버튼 표시
- 클릭 시 해당 플랫폼 결과만 선택/해제
- 선택된 개수 표시
- 기존 "전체 선택" 기능과 함께 동작
  </done>
</task>

<task type="auto">
  <name>Task 3: 전체 선택과의 상호작용 개선</name>
  <files>src/components/UnifiedSearch.tsx</files>
  <action>
기존 "전체 선택" 버튼 영역(라인 2593-2627)에 플랫폼별 선택 상태 요약 추가:

현재:
```tsx
{selectedCount > 0 && (
  <span className="text-xs sm:text-sm text-primary font-medium">
    {selectedCount}개 선택
  </span>
)}
```

수정 후:
```tsx
{selectedCount > 0 && (
  <span className="text-xs sm:text-sm text-primary font-medium">
    {selectedCount}개 선택
    {/* 선택된 플랫폼 수 표시 (2개 이상 플랫폼에서 선택된 경우) */}
    {(() => {
      const platformsWithSelection = PLATFORMS.filter(
        (p) => enabledPlatforms.has(p.id) && getSelectedCountByPlatform(p.id) > 0
      );
      if (platformsWithSelection.length > 1) {
        return (
          <span className="text-zinc-400 dark:text-zinc-500 font-normal ml-1">
            ({platformsWithSelection.length}개 플랫폼)
          </span>
        );
      }
      return null;
    })()}
  </span>
)}
```

이렇게 하면 여러 플랫폼에서 선택했을 때 "(3개 플랫폼)" 같은 정보가 추가로 표시됨.
  </action>
  <verify>
1. 여러 플랫폼에서 일부씩 선택 후 헤더에 플랫폼 수 표시 확인
2. 단일 플랫폼만 선택 시 플랫폼 수 표시 안 됨 확인
3. "전체 선택" 클릭 시 모든 플랫폼 선택됨 확인
4. 플랫폼별 "해제" 후 "전체 선택" 시 다시 모두 선택됨 확인
  </verify>
  <done>
- 선택 상태에 플랫폼 수 정보 추가 표시
- 전체 선택과 플랫폼별 선택이 자연스럽게 연동
  </done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] npm run build 성공 (타입 에러 없음)
- [ ] 플랫폼별 선택/해제 기능 동작
- [ ] 전체 선택/해제와 플랫폼별 선택 상호작용 정상
- [ ] 선택된 결과 일괄 저장 기능 정상 동작
- [ ] 모바일 UI에서도 버튼 크기/간격 적절
</verification>

<success_criteria>

- 각 플랫폼 헤더에 선택 버튼 추가
- 플랫폼별 선택/해제 기능 구현
- 선택 상태 UI 피드백 (개수, 색상)
- 전체 선택과의 자연스러운 연동
- 기존 기능 (검색, 저장) 정상 동작
</success_criteria>

<output>
After completion, create `.planning/phases/33-unified-search-category-selection/33-01-SUMMARY.md`:

# Phase 33 Plan 01: Unified Search Category Selection Summary

**[실질적인 한 줄 요약]**

## Accomplishments

- [구현된 기능들]

## Files Created/Modified

- `src/components/UnifiedSearch.tsx` - 플랫폼별 선택 함수 및 UI 추가

## Decisions Made

[결정 사항들 또는 "None"]

## Issues Encountered

[발생한 문제와 해결 방법 또는 "None"]

## Next Step

Phase 33 완료, 다음 단계 대기
</output>
