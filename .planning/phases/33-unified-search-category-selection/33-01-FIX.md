---
phase: 33-unified-search-category-selection
plan: 01-FIX
type: fix
---

<objective>
Fix 3 UAT issues from plan 33-01.

Source: 33-01-ISSUES.md
Priority: 1 blocker, 1 major, 1 minor

**Analysis:**
코드 검토 결과, 플랫폼별 선택 기능은 올바르게 구현되어 있음:
- `getSelectableByPlatform`, `togglePlatformSelection` 등 헬퍼 함수 존재 (라인 1927-1964)
- 플랫폼 헤더에 선택 버튼 UI 구현됨 (라인 2739-2770)
- 전체 선택 영역에 플랫폼 정보도 존재

**가능한 문제 원인:**
1. `selectable.length === 0` 조건으로 인해 버튼이 숨겨짐 (모든 결과가 이미 저장된 경우)
2. 개발 서버 캐시 문제
3. UI가 표시되는 조건이 너무 엄격함

**수정 방향:**
- 저장된 결과도 선택 가능하도록 로직 수정 (선택은 저장 안 된 것만, 표시는 전체)
- 버튼 표시 조건 완화 (결과가 있으면 버튼 표시)
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md

**Issues being fixed:**
@.planning/phases/33-unified-search-category-selection/33-01-ISSUES.md

**Original plan for reference:**
@.planning/phases/33-unified-search-category-selection/33-01-PLAN.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: UAT-001 수정 - 플랫폼별 선택 버튼 표시 조건 완화</name>
  <files>src/components/UnifiedSearch.tsx</files>
  <action>
현재 버튼 표시 조건:
```tsx
if (selectable.length === 0) return null;
```

이 조건은 저장 안 된 결과가 없으면 버튼을 숨김. 그러나 사용자는 저장된 결과가 있더라도 버튼을 보고 싶을 수 있음.

수정: 플랫폼에 결과가 있으면 버튼 표시 (저장 여부와 관계없이)

라인 2740-2770 영역의 IIFE를 수정:
- `getSelectableByPlatform` 대신 해당 플랫폼의 전체 결과 수 확인
- 플랫폼 결과가 1개 이상이면 버튼 표시
- 선택 가능한(저장 안 된) 결과가 있을 때만 버튼 활성화

```tsx
{(() => {
  const platformResultsData = platformResults.get(platformConfig.id);
  const totalCount = platformResultsData?.results.length || 0;
  if (totalCount === 0) return null;

  const selectable = getSelectableByPlatform(platformConfig.id);
  const selectedInPlatform = getSelectedCountByPlatform(platformConfig.id);
  const isAllSelected = selectable.length > 0 && selectedInPlatform === selectable.length;
  const hasSelectable = selectable.length > 0;

  return (
    <div className="flex items-center gap-1.5">
      {selectedInPlatform > 0 && (
        <span className="text-xs text-primary">
          {selectedInPlatform}개
        </span>
      )}
      {hasSelectable && (
        <motion.button
          onClick={(e) => {
            e.stopPropagation();
            togglePlatformSelection(platformConfig.id);
          }}
          className={`px-2 py-0.5 text-xs rounded transition-colors ${
            isAllSelected
              ? 'bg-primary/10 text-primary'
              : 'bg-zinc-100 dark:bg-zinc-700 text-zinc-500 dark:text-zinc-400 hover:bg-zinc-200 dark:hover:bg-zinc-600'
          }`}
          {...pressScale}
        >
          {isAllSelected ? '해제' : '선택'}
        </motion.button>
      )}
    </div>
  );
})()}
```

핵심 변경:
- 플랫폼 결과가 있으면 컨테이너 div 표시
- 선택 가능한 결과가 있을 때만 버튼 표시
- 선택된 개수는 항상 표시 (선택된 게 있을 때)
  </action>
  <verify>
1. npm run dev 실행
2. 통합 검색 모달에서 검색 실행
3. 각 플랫폼 헤더에 "선택" 버튼 표시 확인
4. 일부 결과 저장 후에도 버튼 유지 확인
  </verify>
  <done>
- 플랫폼에 결과가 있으면 버튼 영역 표시
- 선택 가능한 결과가 있을 때 버튼 클릭 가능
- 모든 결과가 저장된 경우에도 선택된 개수 표시 유지
  </done>
</task>

<task type="auto">
  <name>Task 2: UAT-002 수정 - 플랫폼별 선택 개수 표시 개선</name>
  <files>src/components/UnifiedSearch.tsx</files>
  <action>
현재는 selectedInPlatform > 0일 때만 개수 표시.
"(2/5)" 형식으로 선택수/전체수 표시하도록 개선.

Task 1에서 수정한 코드에 추가:
```tsx
{/* 선택 가능한 결과가 있으면 선택 상태 표시 */}
{selectable.length > 0 && (
  <span className="text-xs text-zinc-500 dark:text-zinc-400">
    ({selectedInPlatform}/{selectable.length})
  </span>
)}
```

또는 더 간결하게:
```tsx
{hasSelectable && (
  <span className={`text-xs ${selectedInPlatform > 0 ? 'text-primary' : 'text-zinc-400 dark:text-zinc-500'}`}>
    {selectedInPlatform}/{selectable.length}
  </span>
)}
```

이렇게 하면 "2/5" 형식으로 선택 상태가 항상 표시됨.
  </action>
  <verify>
1. 통합 검색에서 검색 실행
2. 각 플랫폼 헤더에 "0/5" 같은 형식 표시 확인
3. 일부 선택 후 "2/5" 같이 업데이트 확인
4. 전체 선택 시 "5/5" 표시 확인
  </verify>
  <done>
- 플랫폼 헤더에 "(선택수/전체수)" 형식 표시
- 선택 상태에 따라 색상 변경
- 실시간 업데이트
  </done>
</task>

<task type="auto">
  <name>Task 3: UAT-003 수정 - 전체 선택 헤더에 플랫폼 정보 표시</name>
  <files>src/components/UnifiedSearch.tsx</files>
  <action>
현재 전체 선택 영역(라인 2593 근처)에 플랫폼 수 정보가 있는지 확인하고 없으면 추가.

찾아야 할 위치: selectedCount > 0 조건 내부

수정:
```tsx
{selectableCount > 0 && (
  <div className="flex items-center gap-2">
    <span className="text-xs text-zinc-500 dark:text-zinc-400">
      {(() => {
        const platformsWithResults = PLATFORMS.filter(
          (p) => enabledPlatforms.has(p.id) && getSelectableByPlatform(p.id).length > 0
        );
        return `${platformsWithResults.length}개 플랫폼`;
      })()}
    </span>
    ...기존 전체 선택 버튼...
  </div>
)}
```

또는 선택된 개수 옆에 표시:
```tsx
{selectedCount > 0 && (
  <span className="text-xs sm:text-sm text-primary font-medium">
    {selectedCount}개 선택
    {(() => {
      const platformsWithSelection = PLATFORMS.filter(
        (p) => enabledPlatforms.has(p.id) && getSelectedCountByPlatform(p.id) > 0
      );
      if (platformsWithSelection.length > 1) {
        return (
          <span className="text-zinc-400 dark:text-zinc-500 font-normal ml-1">
            ({platformsWithSelection.length}개 플랫폼)
          </span>
        );
      }
      return null;
    })()}
  </span>
)}
```

PLAN.md에서 이 코드가 이미 구현되어 있다고 했으므로, 실제로 존재하는지 확인하고 없으면 추가.
  </action>
  <verify>
1. 여러 플랫폼에서 결과 선택
2. 전체 선택 영역에 "(3개 플랫폼)" 형식 표시 확인
3. 단일 플랫폼 선택 시 플랫폼 수 표시 안 됨 확인
  </verify>
  <done>
- 전체 선택 영역에 플랫폼 수 정보 표시
- 2개 이상 플랫폼 선택 시에만 표시
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] npm run build 성공
- [ ] 플랫폼별 선택 버튼 표시됨
- [ ] 플랫폼별 선택 개수 "(N/M)" 형식 표시됨
- [ ] 전체 선택 영역에 플랫폼 수 정보 표시됨 (2개 이상 선택 시)
- [ ] 선택/해제 기능 정상 동작
- [ ] 모바일 UI 적절함
</verification>

<success_criteria>
- All UAT issues from 33-01-ISSUES.md addressed
- Tests pass
- Ready for re-verification
</success_criteria>

<output>
After completion, create `.planning/phases/33-unified-search-category-selection/33-01-FIX-SUMMARY.md`
</output>
