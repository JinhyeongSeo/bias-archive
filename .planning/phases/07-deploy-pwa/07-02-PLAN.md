---
phase: 07-deploy-pwa
plan: 02
type: execute
depends_on: ["07-01"]
files_modified: [next.config.ts, public/manifest.json, public/sw.js, src/app/[locale]/layout.tsx]
---

<objective>
PWA(Progressive Web App) 지원을 추가하여 앱처럼 설치 가능하게 만든다.

Purpose: 모바일/데스크톱에서 앱처럼 설치하고 사용할 수 있게 함
Output: PWA manifest, 서비스 워커, 앱 아이콘 설정 완료
</objective>

<execution_context>
./.claude/get-shit-done/workflows/execute-plan.md
./summary.md
./.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-deploy-pwa/07-01-SUMMARY.md
@src/app/[locale]/layout.tsx
@next.config.ts

**Tech stack:** Next.js 16.1.1, next-intl
**Prior decisions:** npm 사용, [locale] 라우팅 구조
**배포 URL:** (07-01에서 확인)
</context>

<tasks>

<task type="auto">
  <name>Task 1: PWA manifest.json 생성</name>
  <files>public/manifest.json, src/app/[locale]/layout.tsx</files>
  <action>
1. `public/manifest.json` 생성:
   ```json
   {
     "name": "내 최애 아카이브",
     "short_name": "최애 아카이브",
     "description": "직캠과 사진 링크를 태그별로 정리하는 미디어 큐레이션 앱",
     "start_url": "/ko",
     "display": "standalone",
     "background_color": "#ffffff",
     "theme_color": "#000000",
     "orientation": "portrait-primary",
     "icons": [
       {
         "src": "/icons/icon-192x192.png",
         "sizes": "192x192",
         "type": "image/png",
         "purpose": "any maskable"
       },
       {
         "src": "/icons/icon-512x512.png",
         "sizes": "512x512",
         "type": "image/png",
         "purpose": "any maskable"
       }
     ]
   }
   ```

2. `src/app/[locale]/layout.tsx`의 metadata에 manifest 링크 추가:
   - manifest: '/manifest.json' 추가
   - themeColor 추가
   - viewport에 PWA 관련 설정 추가

주의: next-pwa 라이브러리 없이 수동 설정 (더 가벼움, Next.js 16 호환성 보장)
  </action>
  <verify>브라우저 개발자 도구 > Application > Manifest에서 manifest 로드 확인</verify>
  <done>manifest.json이 올바르게 로드되고 파싱됨</done>
</task>

<task type="auto">
  <name>Task 2: 앱 아이콘 및 서비스 워커 설정</name>
  <files>public/icons/icon-192x192.png, public/icons/icon-512x512.png, public/sw.js, src/app/[locale]/layout.tsx</files>
  <action>
1. `public/icons/` 디렉토리 생성

2. 간단한 아이콘 생성 (SVG 기반):
   - 192x192, 512x512 PNG 아이콘
   - 하트 또는 별 모양의 심플한 디자인 (최애 아카이브 테마)
   - 배경색: #000000 또는 테마 색상
   - 기호 색상: #ffffff 또는 대조색

3. `public/sw.js` 기본 서비스 워커 생성:
   ```javascript
   // 간단한 캐시 전략
   const CACHE_NAME = 'bias-archive-v1';
   const urlsToCache = [
     '/',
     '/ko',
     '/en'
   ];

   self.addEventListener('install', (event) => {
     event.waitUntil(
       caches.open(CACHE_NAME)
         .then((cache) => cache.addAll(urlsToCache))
     );
   });

   self.addEventListener('fetch', (event) => {
     event.respondWith(
       caches.match(event.request)
         .then((response) => response || fetch(event.request))
     );
   });
   ```

4. layout.tsx에 서비스 워커 등록 스크립트 추가:
   - useEffect로 'serviceWorker' in navigator 체크 후 등록

주의:
- 서비스 워커는 HTTPS에서만 작동 (localhost 예외)
- 캐싱은 정적 자산만 (API 응답 X)
- FFmpeg WASM 파일은 캐시하지 않음 (용량 문제)
  </action>
  <verify>
    1. npm run build && npm run start
    2. http://localhost:3000 접속
    3. 개발자 도구 > Application > Service Workers 확인
  </verify>
  <done>서비스 워커 등록됨, 아이콘이 표시됨</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>PWA 설정 완료 (manifest, 아이콘, 서비스 워커)</what-built>
  <how-to-verify>
    1. 프로덕션 URL 방문 (또는 로컬 npm run start)
    2. PWA 설치 테스트:
       - Chrome: 주소창 오른쪽 '설치' 아이콘 확인
       - 또는 메뉴 > '앱 설치' 옵션 확인
    3. 설치 후 확인:
       - 앱 아이콘이 바탕화면/앱 목록에 추가됨
       - 앱이 standalone 모드로 실행됨 (브라우저 UI 없음)
       - 기본 기능 정상 작동
    4. 개발자 도구 > Application 확인:
       - Manifest가 로드됨
       - Service Worker가 활성화됨
       - 아이콘이 올바르게 표시됨
  </how-to-verify>
  <resume-signal>"approved"를 입력하거나 발견된 문제를 설명해주세요</resume-signal>
</task>

</tasks>

<verification>
Phase 완료 전 확인:
- [ ] manifest.json이 올바르게 설정됨
- [ ] 앱 아이콘 (192x192, 512x512)이 생성됨
- [ ] 서비스 워커가 등록되고 작동함
- [ ] PWA 설치 프롬프트가 표시됨
- [ ] 설치 후 앱이 standalone으로 실행됨
</verification>

<success_criteria>

- PWA로 설치 가능
- 앱 아이콘이 올바르게 표시됨
- 기본 오프라인 지원 (정적 페이지 캐싱)
- Phase 7 complete
</success_criteria>

<output>
완료 후 `.planning/phases/07-deploy-pwa/07-02-SUMMARY.md` 생성:

# Plan 07-02: PWA 설정 Summary

**[PWA 설치 가능, 앱처럼 실행]**

## Accomplishments

- [PWA 설정 결과]

## Files Created/Modified

- public/manifest.json
- public/icons/icon-*.png
- public/sw.js
- src/app/[locale]/layout.tsx

## Decisions Made

- [PWA 관련 결정사항]

## Issues Encountered

- [문제와 해결 방법]

## Next Step

Phase 7 complete. 프로젝트 마일스톤 완료!
</output>
