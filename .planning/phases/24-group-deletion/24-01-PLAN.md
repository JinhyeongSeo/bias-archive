---
phase: 24-group-deletion
plan: 01
type: execute
depends_on: []
files_modified: [src/app/api/groups/[id]/route.ts, src/components/BiasManager.tsx]
---

<objective>
BiasManager에서 그룹 전체를 한 번에 삭제하는 기능 추가

Purpose: 현재 멤버 각각 삭제만 가능한데, 그룹 전체를 한 번에 삭제할 수 있어야 함
Output: 그룹 헤더에 삭제 버튼 추가, DELETE API 엔드포인트 생성
</objective>

<execution_context>
./.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@src/components/BiasManager.tsx
@src/app/api/biases/[id]/route.ts
@src/app/api/groups/route.ts

**기존 패턴 참조:**
- 최애 삭제: `deletingId` 상태, `handleDelete()` 함수, hover시 X 버튼 표시
- DB FK: `ON DELETE SET NULL` → 그룹 삭제 시 biases.group_id가 자동으로 NULL됨
- RLS: `groups_delete_policy`가 user_id 기반 권한 검사

**UI 구조:**
- 그룹 헤더 (BiasManager.tsx 806-845줄): 드래그 핸들, 토글/이름, 멤버수 표시
- 삭제 버튼은 멤버수 옆에 hover시 노출
</context>

<tasks>

<task type="auto">
  <name>Task 1: Groups DELETE API 엔드포인트 생성</name>
  <files>src/app/api/groups/[id]/route.ts</files>
  <action>
  biases/[id]/route.ts의 DELETE 패턴을 참고하여 구현:

  1. createClient로 Supabase 서버 클라이언트 생성
  2. getUser()로 인증 확인 (미인증시 401)
  3. params.id로 그룹 ID 추출
  4. supabase.from('groups').delete().eq('id', id) 실행
  5. RLS 정책이 user_id 검증 자동 처리
  6. 성공시 { success: true } 반환, 실패시 500 에러

  DB FK가 ON DELETE SET NULL이므로 연관 biases는 자동으로 group_id=NULL이 됨
  별도 cascade 처리 불필요
  </action>
  <verify>curl -X DELETE http://localhost:3000/api/groups/{test-id} 호출 시 적절한 응답 확인</verify>
  <done>DELETE /api/groups/[id] 엔드포인트가 인증된 사용자의 그룹을 삭제</done>
</task>

<task type="auto">
  <name>Task 2: BiasManager 그룹 삭제 UI 추가</name>
  <files>src/components/BiasManager.tsx</files>
  <action>
  최애 삭제 패턴(deletingId, handleDelete)을 그대로 따라서 구현:

  1. 상태 추가: deletingGroupId (string | null)

  2. 함수 추가: handleDeleteGroup(groupId: string, groupName: string)
     - confirm 다이얼로그: `"${groupName}" 그룹을 삭제하시겠습니까? 그룹 내 최애들은 유지됩니다.`
     - setDeletingGroupId(groupId) 설정
     - fetch(`/api/groups/${groupId}`, { method: 'DELETE' })
     - 성공시 onBiasDeleted() 콜백 호출 (부모가 그룹/최애 목록 새로고침)
     - finally에서 setDeletingGroupId(null)

  3. 그룹 헤더에 삭제 버튼 추가 (806-845줄 영역):
     - 멤버수 표시 옆에 배치
     - opacity-0 group-hover:opacity-100 클래스로 hover시만 표시
     - disabled={deletingGroupId === group.id}
     - 로딩중이면 스피너, 아니면 X 아이콘
     - motion.button 사용 (기존 패턴)
     - title="그룹 삭제"

  hover 상태 적용을 위해 그룹 헤더 컨테이너에 group 클래스 추가 필요
  </action>
  <verify>npm run dev 후 BiasManager에서 그룹 헤더 hover시 삭제 버튼 표시, 클릭시 확인 후 삭제</verify>
  <done>그룹 헤더에 삭제 버튼 표시, 클릭시 확인 다이얼로그 후 그룹 삭제, 최애는 유지됨</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `npm run build` 에러 없음
- [ ] 그룹 삭제 버튼이 hover시 표시됨
- [ ] 삭제 확인 다이얼로그가 한국어로 표시됨
- [ ] 그룹 삭제 후 해당 그룹의 최애들이 "그룹 없음" 섹션으로 이동됨
- [ ] 권한 없는 그룹 삭제 시도시 에러 처리됨
</verification>

<success_criteria>

- 모든 태스크 완료
- 빌드 에러 없음
- 그룹 삭제 기능 정상 동작
- 기존 최애 데이터 보존됨
</success_criteria>

<output>
완료 후 `.planning/phases/24-group-deletion/24-01-SUMMARY.md` 생성:

# Phase 24 Plan 01: Group Deletion Summary

**그룹 삭제 기능 추가 완료**

## Accomplishments

- DELETE /api/groups/[id] 엔드포인트 생성
- BiasManager 그룹 헤더에 삭제 버튼 추가
- 확인 다이얼로그 및 로딩 상태 표시

## Files Created/Modified

- `src/app/api/groups/[id]/route.ts` - DELETE 엔드포인트 신규
- `src/components/BiasManager.tsx` - 그룹 삭제 UI 추가

## Decisions Made

- DB FK의 ON DELETE SET NULL 활용 (cascade 삭제 아님)
- 최애는 유지하고 group_id만 NULL로 설정

## Issues Encountered

[문제 및 해결책, 또는 "None"]

## Next Step

Phase 24 complete, ready for milestone completion
</output>
