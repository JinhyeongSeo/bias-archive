---
phase: 05-viewer-timeline
plan: 02
type: execute
depends_on: []
files_modified: [src/lib/youtube.ts, src/app/api/youtube/search/route.ts, src/components/ExternalSearch.tsx]
---

<objective>
YouTube 검색 필터 기능 추가 - 기간 필터 및 조회수 정렬

Purpose: "이번주에 인기 많았던 영상 순으로" 검색 가능하게 함
Output: YouTube 검색에 기간 필터(오늘/이번주/이번달) + 정렬 옵션(조회수/날짜) 추가
</objective>

<execution_context>
./.claude/get-shit-done/workflows/execute-plan.md
./summary.md
./.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/MILESTONE-CONTEXT.md
@src/lib/youtube.ts
@src/app/api/youtube/search/route.ts
@src/components/ExternalSearch.tsx

**From MILESTONE-CONTEXT.md:**
- YouTube API 지원 정렬: relevance, date, viewCount, rating
- 기간 필터: publishedAfter 파라미터 사용

**Tech stack available:**
- YouTube Data API v3
</context>

<tasks>

<task type="auto">
  <name>Task 1: YouTube API 필터 파라미터 추가</name>
  <files>src/lib/youtube.ts, src/app/api/youtube/search/route.ts</files>
  <action>
1. src/lib/youtube.ts 수정:
   - searchYouTube() 함수에 options 파라미터 추가:
     - order?: 'relevance' | 'date' | 'viewCount' | 'rating'
     - publishedAfter?: string (ISO 8601 형식)
   - YouTube API URL에 order, publishedAfter 파라미터 추가

2. src/app/api/youtube/search/route.ts 수정:
   - query params에서 order, period 받기
   - period를 publishedAfter로 변환:
     - 'today': 오늘 00:00 UTC
     - 'week': 7일 전
     - 'month': 30일 전
     - 'year': 365일 전
   - searchYouTube()에 옵션 전달
  </action>
  <verify>curl "/api/youtube/search?q=test&order=viewCount&period=week" 응답 확인</verify>
  <done>YouTube API가 필터 파라미터를 받아 필터링된 결과 반환</done>
</task>

<task type="auto">
  <name>Task 2: ExternalSearch UI 필터 추가</name>
  <files>src/components/ExternalSearch.tsx</files>
  <action>
ExternalSearch.tsx 수정:
1. 상태 추가:
   - youtubeOrder: 'relevance' | 'date' | 'viewCount'
   - youtubePeriod: '' | 'today' | 'week' | 'month' | 'year'

2. YouTube 탭에 필터 UI 추가 (검색창 아래):
   - 정렬 드롭다운: 관련성순(기본), 조회수순, 최신순
   - 기간 드롭다운: 전체(기본), 오늘, 이번주, 이번달, 올해

3. searchYouTube() 호출 시 필터 파라미터 전달

4. 스타일: 기존 UI와 일관된 Tailwind 클래스 사용
   - select 태그 또는 버튼 그룹
   - 다크모드 지원
  </action>
  <verify>UI에서 필터 선택 후 검색 결과가 필터에 맞게 변경됨</verify>
  <done>YouTube 검색에 기간/정렬 필터 UI 추가됨</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>YouTube 검색 필터 기능 (기간 + 정렬)</what-built>
  <how-to-verify>
    1. Run: npm run dev
    2. 외부 검색 모달 열기 → YouTube 탭
    3. 검색어 입력 (예: "아이브 직캠")
    4. 정렬을 "조회수순"으로 변경 → 결과가 조회수 높은 순으로
    5. 기간을 "이번주"로 변경 → 최근 7일 영상만 표시
    6. 필터 조합 테스트: "이번달 + 조회수순"
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] npm run build 성공
- [ ] YouTube 검색 API가 order, period 파라미터 지원
- [ ] UI에서 필터 선택 가능
- [ ] 필터 적용 시 결과가 변경됨
</verification>

<success_criteria>
- YouTube 검색에 정렬 옵션 (관련성/조회수/최신) 추가
- YouTube 검색에 기간 필터 (전체/오늘/이번주/이번달/올해) 추가
- 필터 조합이 정상 작동
- User verification passed
</success_criteria>

<output>
After completion, create `.planning/phases/05-viewer-timeline/05-02-SUMMARY.md`
</output>
