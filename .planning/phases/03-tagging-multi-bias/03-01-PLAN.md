---
phase: 03-tagging-multi-bias
plan: 01
type: execute
depends_on: []
files_modified: [src/app/api/biases/route.ts, src/app/api/biases/[id]/route.ts, src/lib/biases.ts, src/components/BiasManager.tsx, src/components/Sidebar.tsx]
---

<objective>
최애(bias) 관리 CRUD 기능 구현 - API 엔드포인트와 UI 컴포넌트

Purpose: 여러 아이돌/그룹을 개별 추적하고 링크에 연결할 수 있는 기반 마련
Output: Bias 생성/조회/수정/삭제 API + 사이드바에 최애 목록 표시 + 추가/삭제 UI
</objective>

<execution_context>
./.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-link-management/02-03-SUMMARY.md

**Tech stack:**
- Next.js 14 App Router
- Supabase (biases 테이블 이미 존재)
- Tailwind CSS

**Established patterns:**
- API: `src/app/api/*/route.ts` (GET/POST), `src/app/api/*/[id]/route.ts` (PUT/DELETE)
- DB 함수: `src/lib/*.ts` (e.g., links.ts)
- 타입: `src/types/database.ts` (이미 Bias 타입 정의됨)
- refreshTrigger 패턴으로 목록 새로고침

**Key files:**
@src/lib/links.ts
@src/app/api/links/route.ts
@src/components/Sidebar.tsx
@src/types/database.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Bias CRUD API 생성</name>
  <files>src/lib/biases.ts, src/app/api/biases/route.ts, src/app/api/biases/[id]/route.ts</files>
  <action>
1. `src/lib/biases.ts` 생성:
   - getBiases(): 전체 목록 조회 (created_at DESC)
   - getBias(id): 단일 조회
   - createBias(name, group_name?): 생성
   - updateBias(id, name, group_name?): 수정
   - deleteBias(id): 삭제
   - 기존 links.ts 패턴 따를 것

2. `src/app/api/biases/route.ts`:
   - GET: getBiases() 호출, 목록 반환
   - POST: body에서 name, group_name 추출, createBias() 호출

3. `src/app/api/biases/[id]/route.ts`:
   - GET: getBias(id) 호출
   - PUT: updateBias(id, name, group_name) 호출
   - DELETE: deleteBias(id) 호출

에러 처리: try-catch로 감싸고, 실패 시 NextResponse.json({ error }, { status: 500 })
  </action>
  <verify>
curl -X POST http://localhost:3000/api/biases -H "Content-Type: application/json" -d '{"name":"RORA","group_name":"BABYMONSTER"}' 반환 확인
curl http://localhost:3000/api/biases 목록 반환 확인
  </verify>
  <done>Bias CRUD API 4개 엔드포인트 동작, 생성/조회/수정/삭제 모두 가능</done>
</task>

<task type="auto">
  <name>Task 2: 사이드바 최애 목록 표시</name>
  <files>src/components/Sidebar.tsx</files>
  <action>
1. Sidebar.tsx 수정:
   - useState로 biases 상태 관리
   - useEffect로 /api/biases GET 호출하여 목록 로드
   - 목록 렌더링: 각 bias를 클릭 가능한 버튼으로 표시
   - 형식: "멤버명 (그룹명)" 또는 그룹명 없으면 멤버명만
   - 빈 상태: 기존 "아직 최애가 없습니다" 유지

2. 스타일:
   - 각 항목: hover 시 배경색 변경
   - 선택된 항목: 강조 스타일 (추후 필터링에 사용)
   - 기존 Tailwind 클래스 패턴 따를 것
  </action>
  <verify>npm run dev 후 브라우저에서 사이드바에 최애 목록 표시 확인</verify>
  <done>사이드바에 DB의 bias 목록이 표시됨, 빈 상태도 올바르게 처리됨</done>
</task>

<task type="auto">
  <name>Task 3: 최애 추가/삭제 UI</name>
  <files>src/components/BiasManager.tsx, src/components/Sidebar.tsx</files>
  <action>
1. `src/components/BiasManager.tsx` 생성:
   - 모달 또는 인라인 폼으로 구현 (사이드바 내 인라인 권장)
   - 입력 필드: 이름(필수), 그룹명(선택)
   - 추가 버튼: POST /api/biases 호출 후 목록 새로고침
   - 삭제 버튼: 각 항목 옆에 X 아이콘, DELETE /api/biases/[id] 호출
   - 로딩 상태: 버튼 비활성화 + 로딩 표시

2. Sidebar.tsx 수정:
   - BiasManager 컴포넌트 import 및 사용
   - refreshTrigger 패턴으로 추가/삭제 후 목록 새로고침
   - 또는 내부적으로 fetchBiases 함수를 prop으로 전달

3. UX:
   - 추가 폼은 기본 숨김, "+" 버튼 클릭 시 표시
   - 삭제 시 confirm 대화상자 표시
  </action>
  <verify>
1. 사이드바에서 "+" 버튼 클릭하여 폼 표시
2. 이름 입력 후 추가 → 목록에 표시
3. X 버튼으로 삭제 → 목록에서 제거
  </verify>
  <done>최애 추가/삭제가 UI에서 가능하고, 변경사항이 즉시 반영됨</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `npm run build` 에러 없음
- [ ] GET /api/biases 목록 반환
- [ ] POST /api/biases 생성 성공
- [ ] DELETE /api/biases/[id] 삭제 성공
- [ ] 사이드바에 최애 목록 표시
- [ ] UI에서 추가/삭제 동작
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No TypeScript errors
- Bias CRUD 전체 흐름 동작
</success_criteria>

<output>
After completion, create `.planning/phases/03-tagging-multi-bias/03-01-SUMMARY.md`
</output>
