---
phase: 13-enhanced-tag-matching
plan: 01
type: execute
depends_on: []
files_modified: [src/lib/autoTag.ts, src/app/api/links/route.ts]
---

<objective>
autoTag 로직을 확장하여 영어 또는 한글 이름 어느 쪽으로 태그해도 매칭되도록 구현

Purpose: 콘텐츠가 영어/한글 어느 언어로 작성되어 있어도 등록된 최애를 자동으로 태깅
Output: 양방향 이름 매칭이 가능한 extractAutoTags 함수
</objective>

<execution_context>
./.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior phase context (directly relevant)
@.planning/phases/11-bias-schema-extension/11-01-SUMMARY.md
@.planning/phases/12-language-toggle-ui/12-01-SUMMARY.md

# Key source files
@src/lib/autoTag.ts
@src/types/database.ts

**Tech stack available:**
- biases 테이블에 name, name_en, name_ko 필드 존재 (Phase 11)
- Bias 타입에 name_en: string | null, name_ko: string | null 정의됨

**Established patterns:**
- extractAutoTags(text, biases) → string[] 패턴
- isNameInText(text, name) 헬퍼로 단어 경계/한글 처리
- matchedTags.add(bias.name) 으로 항상 display name 반환

**Constraining decisions:**
- Phase 11: 기존 name 필드는 유지 (display name + 태그 매칭용)
- Phase 12: 반환 태그는 name 필드 값 (언어 설정에 따라 UI에서 표시 변환)
</context>

<tasks>

<task type="auto">
  <name>Task 1: extractAutoTags 양방향 매칭 확장</name>
  <files>src/lib/autoTag.ts</files>
  <action>
extractAutoTags 함수를 수정하여 bias의 name, name_en, name_ko 세 필드 모두에서 매칭을 시도:

1. isNameInText 호출을 세 필드에 대해 수행:
   - bias.name (기존 - display name)
   - bias.name_en (영어 이름, null 체크)
   - bias.name_ko (한글 이름, null 체크)

2. 어느 필드에서든 매칭되면 matchedTags.add(bias.name)
   - 반환 태그는 항상 bias.name (display name)
   - 이렇게 하면 "RORA" 또는 "로라" 어느 쪽으로 검색해도 동일한 태그 생성

3. 그룹 이름 매칭도 동일 패턴 적용:
   - group_name 필드만 체크 (그룹에는 영어/한글 이름 분리가 없음)
   - 현재 로직 유지

4. null 체크 필수:
   - name_en, name_ko가 null일 수 있으므로 체크 후 isNameInText 호출
   - 빈 문자열도 스킵 (normalizedName이 빈 경우)
  </action>
  <verify>npm run build && npm run lint -- src/lib/autoTag.ts</verify>
  <done>
- extractAutoTags가 name, name_en, name_ko 세 필드 모두에서 매칭
- 어느 언어로 매칭되든 bias.name 반환
- null/빈 문자열 안전 처리
- 빌드 성공
  </done>
</task>

<task type="auto">
  <name>Task 2: 태그 매칭 수동 테스트 및 확인</name>
  <files>src/app/api/links/route.ts</files>
  <action>
기존 API 코드 변경 없이 동작 확인:

1. src/app/api/links/route.ts 확인:
   - extractAutoTags 호출 시 biases 배열을 전달
   - biases에는 name_en, name_ko가 이미 포함됨 (Phase 11에서 타입 확장)
   - 별도 수정 불필요 확인

2. 빌드 및 전체 타입 체크:
   - npm run build로 전체 프로젝트 빌드 확인
   - TypeScript 에러 없음 확인

3. 주석으로 동작 설명 추가 (autoTag.ts):
   - extractAutoTags 함수에 양방향 매칭 설명 추가
   - 예시: "RORA" or "로라" → matches bias with name_en="RORA", name_ko="로라"
  </action>
  <verify>npm run build</verify>
  <done>
- API 코드 변경 없이 자동 태그 양방향 매칭 동작
- 빌드 성공, 타입 에러 없음
- 함수 문서화 업데이트
  </done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] npm run build 성공
- [ ] npm run lint 성공
- [ ] extractAutoTags가 name, name_en, name_ko 세 필드 매칭
- [ ] 매칭 결과는 항상 bias.name 반환 (display name)
- [ ] null/undefined 안전 처리
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- 양방향 태그 매칭: 영어 이름("RORA")으로 검색해도, 한글 이름("로라")으로 검색해도 동일한 태그 생성
- 기존 동작 유지: name 필드 매칭도 그대로 동작
- Phase 13 완료, v1.1 Multilingual Mode 마일스톤 완료
</success_criteria>

<output>
After completion, create `.planning/phases/13-enhanced-tag-matching/13-01-SUMMARY.md`:

# Phase 13 Plan 01: Enhanced Tag Matching Summary

**[autoTag 양방향 매칭 - 영어/한글 어느 쪽으로든 태그 자동 인식]**

## Accomplishments

- [Key outcome 1]
- [Key outcome 2]

## Files Created/Modified

- `src/lib/autoTag.ts` - 양방향 이름 매칭 로직

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

v1.1 Multilingual Mode 마일스톤 완료
</output>
